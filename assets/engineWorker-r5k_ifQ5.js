(function(){"use strict";const z={wP:0,wN:1,wB:2,wR:3,wQ:4,wK:5,bP:6,bN:7,bB:8,bR:9,bQ:10,bK:11},Y=12,y=0,Z=1,q=2,P=3,G=4,H=5,b=6,l0=7,n0=8,L=9,V=10,p=11,Q=new BigUint64Array(Y);Q[z.wP]=BigInt("0x000000000000FF00"),Q[z.wN]=BigInt("0x0000000000000042"),Q[z.wB]=BigInt("0x0000000000000024"),Q[z.wR]=BigInt("0x0000000000000081"),Q[z.wQ]=BigInt("0x0000000000000008"),Q[z.wK]=BigInt("0x0000000000000010"),Q[z.bP]=BigInt("0x00FF000000000000"),Q[z.bN]=BigInt("0x4200000000000000"),Q[z.bB]=BigInt("0x2400000000000000"),Q[z.bR]=BigInt("0x8100000000000000"),Q[z.bQ]=BigInt("0x0800000000000000"),Q[z.bK]=BigInt("0x1000000000000000");const W0=0x7f7f7f7f7f7f7f7fn,O0=0xfefefefefefefefen,d0=0x00ffffffffffffffn,K0=0xffffffffffffff00n,lt={0:"P",1:"N",2:"B",3:"R",4:"Q",5:"K",6:"p",7:"n",8:"b",9:"r",10:"q",11:"k"},ft={0:"a",1:"b",2:"c",3:"d",4:"e",5:"f",6:"g",7:"h"},ut=[0xabc123n,0xdef456n,0x789abcn,0x123defn],Q0=0,y0=1,G0=2,V0=3,f0=[1,3,3,5,9,1e3,-1,-3,-3,-5,-9,-1e3],t0=1e5,z0=32,at=[G,P,q,Z],Et=[V,L,n0,l0],gt=[{df:1,dr:0},{df:-1,dr:0},{df:0,dr:1},{df:0,dr:-1},{df:1,dr:1},{df:-1,dr:1},{df:1,dr:-1},{df:-1,dr:-1}],fn=n=>n>=0&&n<64,It=0x03f79d71b4cb0a89n,kt=[0,1,48,2,57,49,28,3,61,58,50,42,38,29,17,4,62,55,59,36,53,51,43,22,45,39,33,30,24,18,12,5,63,47,56,27,60,41,37,16,54,35,52,21,44,32,23,11,46,26,40,15,34,20,31,10,25,14,19,9,13,8,7,6],e0=n=>{if(n===0n)return-1;const t=n&-n,e=BigInt.asUintN(64,t*It),o=Number(e>>58n);return kt[o]},un=n=>{let t=0;for(;n;)n&=n-1n,t++;return t},P0=n=>n===H||n===p,an=n=>!(n%6===y||n%6===Z||P0(n));function En(n){let t=0;for(;n!==0n;)n&=n-1n,t++;return t}const x0=n=>n[y]|n[Z]|n[q]|n[P]|n[G]|n[H],w0=n=>n[b]|n[l0]|n[n0]|n[L]|n[V]|n[p],$=n=>BigInt(x0(n)|w0(n)),s0=(n,t)=>n===0?x0(t):w0(t),Bt=n=>~(x0(n)|w0(n)),_=new Array(64).fill(null);function gn(n){At();for(let t=0;t<Y;t++){let e=n[t];for(;e;){const o=e0(e);_[o]=t,e&=e-1n}}}function At(){for(let n=0;n<64;n++)_[n]=null}gn(Q);function Mt(n,t){return t===0?n[P]|n[G]:n[L]|n[V]}function mt(n,t){return t===0?n[q]|n[G]:n[n0]|n[V]}const R=Array.from({length:Y},()=>[]);An(Q);function In(n){const{piece:t,from:e,to:o,captured:c,promotion:i,enPassant:s,castling:l}=n,r=R[t];if(i!==null?(R[i].push(o),r.splice(r.indexOf(e),1)):r[r.indexOf(e)]=o,c!==null){const f=R[c];if(s){const k=o>e?o-8:o+8;f.splice(f.indexOf(k),1)}else f.splice(f.indexOf(o),1)}if(l)if(e===4){const f=R[P];o===6?f[f.indexOf(7)]=5:f[f.indexOf(0)]=3}else{const f=R[L];o===62?f[f.indexOf(63)]=61:f[f.indexOf(56)]=59}}function kn(n){const{piece:t,from:e,to:o,captured:c,promotion:i,enPassant:s,castling:l}=n,r=R[t];if(i){const f=R[i];f.splice(f.indexOf(o),1),r.push(e)}else r[r.indexOf(o)]=e;if(c!==null){const f=R[c];if(s){const k=o>e?o-8:o+8;f.push(k)}else f.push(o)}if(l)if(e===4){const f=R[P];o===6?f[f.indexOf(5)]=7:f[f.indexOf(3)]=0}else{const f=R[L];o===62?f[f.indexOf(61)]=63:f[f.indexOf(59)]=56}}function Bn(n){const t=n===0?0:6,e=[];for(let o=t;o<t+6;o++)e.push(...R[o]);return e}function T0(){let n=[];for(let t=0;t<Y;t++)n.push(...R[t]);return n}function An(n){for(let t=0;t<Y;t++)R[t].length=0;for(let t=0;t<Y;t++){let e=n[t];const o=R[t];for(;e;){const c=e0(e);o.push(c),e&=e-1n}}}function Mn(n,t,e,o){const c=[];for(let A=7;A>=0;A--){let g="",a=0;for(let E=0;E<8;E++){const u=A*8+E,m=_[u];m===null?a+=1:(a&&(g+=a,a=0),g+=lt[m])}a&&(g+=a),c.push(g)}const i=c.join("/"),s=t===0?"w":"b",l="-",r=o!==null?_t(o):"-";return`${i} ${s} ${l} ${r} 0 1`}function _t(n){const t=Math.floor(n/8)+1,e=n%8;return""+ft[e]+t}function mn(n){let t="";for(let e=7;e>=0;e--){let o="";for(let c=0;c<8;c++){let i=BigInt(1)<<BigInt(e*8+c);o+=n&i?"1 ":"0 "}t+=o.trim()+`
`}return t}const L0=(n,t)=>{const e=t.piece,o=t.captured,c=t.promotion,i=$(n);an(e)||(j[e]=k0(e,i)),o!==null&&!an(o)&&(j[o]=k0(o,i)),(c===Z||c===l0)&&(j[c]=k0(c,i));const s=[q,P,G,n0,L,V],l=wt(t);for(const r of s)xt(r,t,i,l)};function xt(n,t,e,o){if(t.captured===n||t.piece===n||t.promotion===n){j[n]=k0(n,e);return}(j[n]&o)!==0n&&(j[n]=k0(n,e))}function wt(n){let t=0n;if(t|=1n<<BigInt(n.from),t|=1n<<BigInt(n.to),n.enPassant){const e=n.piece<6?-8:8,o=n.to+e;t|=1n<<BigInt(o)}return t}const h0=n=>{let t=0n;if(n===0)for(let e=0;e<6;e++)t|=j[e];else for(let e=6;e<=11;e++)t|=j[e];return t},u0=(n,t,e)=>{const o=[...e];return n===4?(o[Q0]=!1,o[y0]=!1):n===60?(o[G0]=!1,o[V0]=!1):n===0||t===0?o[y0]=!1:n===7||t===7?o[Q0]=!1:n===56||t===56?o[V0]=!1:(n===63||t===63)&&(o[G0]=!1),o},_n=(n,t,e)=>{let o;n===0?o=[4,5,6]:o=[60,61,62];for(const c of o){const i=1n<<BigInt(c);if(t&i||i&e&&(n===0?c!==4:c!==60))return!1}return!0},xn=(n,t,e)=>{let o;n===0?o=[1,2,3,4]:o=[57,58,59,60];for(const c of o){const i=1n<<BigInt(c);if(t&i&&c!==1&&c!==57||i&e&&(n===0?c!==4:c!==60))return!1}return!0},Tt=(n,t)=>{const e=t.from,o=t.to;$(n),e===4&&o===6?(n[H]&=~(1n<<4n),n[H]|=1n<<6n,n[P]&=~(1n<<7n),n[P]|=1n<<5n,_[o]=H,_[e]=null,_[7]=null,_[5]=P):e===4&&o===2?(n[H]&=~(1n<<4n),n[H]|=1n<<2n,n[P]&=~(1n<<0n),n[P]|=1n<<3n,_[o]=H,_[e]=null,_[0]=null,_[3]=P):e===60&&o===62?(n[p]&=~(1n<<60n),n[p]|=1n<<62n,n[L]&=~(1n<<63n),n[L]|=1n<<61n,_[o]=p,_[e]=null,_[63]=null,_[61]=L):e===60&&o===58&&(n[p]&=~(1n<<60n),n[p]|=1n<<58n,n[L]&=~(1n<<56n),n[L]|=1n<<59n,_[o]=p,_[e]=null,_[56]=null,_[59]=L),In(t),L0(n,t)},ht=(n,t)=>{const e=t.from,o=t.to;$(n),e===4&&o===6?(n[H]&=~(1n<<6n),n[H]|=1n<<4n,n[P]&=~(1n<<5n),n[P]|=1n<<7n,_[e]=H,_[o]=null,_[5]=null,_[7]=P):e===4&&o===2?(n[H]&=~(1n<<2n),n[H]|=1n<<4n,n[P]&=~(1n<<3n),n[P]|=1n<<0n,_[e]=H,_[o]=null,_[3]=null,_[0]=P):e===60&&o===62?(n[p]&=~(1n<<62n),n[p]|=1n<<60n,n[L]&=~(1n<<61n),n[L]|=1n<<63n,_[e]=p,_[o]=null,_[61]=null,_[63]=L):e===60&&o===58&&(n[p]&=~(1n<<58n),n[p]|=1n<<60n,n[L]&=~(1n<<59n),n[L]|=1n<<56n,_[e]=p,_[o]=null,_[59]=null,_[56]=L),kn(t),L0(n,t)};class $0{constructor(t,e,o,c,i,s,l){this.from=t,this.to=e,this.piece=o,this.captured=c,this.promotion=i,this.castling=s,this.enPassant=l}copyWith({from:t,to:e,piece:o,captured:c,promotion:i,castling:s,enPassant:l}){return new $0(t??this.from,e??this.to,o??this.piece,c??this.captured,i??this.promotion,s??this.castling,l??this.enPassant)}}const a0=(n,t)=>{const e=1n,o=e<<BigInt(t.from),c=e<<BigInt(t.to),i=t.piece,s=t.captured,l=t.promotion,r=t.enPassant;if($(n),t.castling){Tt(n,t);return}if(n[i]&=~o,t.captured!==null&&!r&&(n[s]&=~c),_[t.from]=null,l?(n[l]|=c,_[t.to]=l):(n[i]|=c,_[t.to]=i),r){const f=i===y?-8:8;n[s]&=~(e<<BigInt(t.to+f)),_[t.to+f]=null}In(t),L0(n,t)},E0=(n,t)=>{const e=n.from,o=n.to,c=1n,i=c<<BigInt(e),s=c<<BigInt(o),l=n.piece,r=n.captured,f=n.promotion,k=n.enPassant;if(n.castling){ht(t,n);return}if(_[o]=null,_[e]=l,f?(t[f]&=~s,t[l]|=i):(t[l]&=~s,t[l]|=i),r!==null&&!k&&(t[r]|=s,_[o]=r),k){const g=o+(l===y?-8:8);t[r]|=c<<BigInt(g),_[g]=r}kn(n),L0(t,n)},Ct=(n,t,e,o)=>{const c=e<=5,i=P0(e)&&Math.abs(n-t)===2,s=t===o&&(e===y||e===b);let l=_[t];return s&&(l=c?b:y),new $0(n,t,e,l,null,i,s)},wn=(n,t,e,o,c)=>{const i=[],s=c===0?6:1,r=Math.floor(t/8)===s&&e%6===y;let f=n;for(;f!==0n;){const k=e0(f);f&=f-1n;const A=Ct(t,k,e,o);if(r){const g=c===0?at:Et;for(const a of g){const E=A.copyWith({promotion:a});i.push(E)}}else i.push(A)}return i},vt=n=>{const t=1n<<BigInt(n);let e=0n;return n%8!==0&&(e|=t<<7n),n%8!==7&&(e|=t<<9n),e},Wt=n=>{const t=1n<<BigInt(n);let e=0n;return n%8!==0&&(e|=t>>9n),n%8!==7&&(e|=t>>7n),e},N0=(()=>{const n=new Array(64);for(let t=0;t<64;t++)n[t]=vt(t);return n})(),H0=(()=>{const n=new Array(64);for(let t=0;t<64;t++)n[t]=Wt(t);return n})(),Ot=[17,15,10,6,-17,-15,-10,-6],dt=n=>{let t=0n;for(const e of Ot){const o=n+e;fn(o)&&Kt(n,o)&&(t|=1n<<BigInt(o))}return t},Kt=(n,t)=>{const e=n%8,o=t%8,c=Math.abs(e-o);return!(c!==1&&c!==2)},X0=(()=>{const n=new Array(64);for(let t=0;t<64;t++)n[t]=dt(t);return n})();function Tn(n,t,e){const o=t===0,c=n[o?b:y],i=(o?N0[e]:H0[e])&c,s=n[o?l0:Z],l=X0[e]&s,r=Pt(n,e,$(n),o);return i|l|r}function Pt(n,t,e,o){let c=0n,s=r0(t,e)&e;const l=o?n[L]|n[V]:n[P]|n[G];c|=s&l;let f=c0(t,e)&e;const k=o?n[n0]|n[V]:n[q]|n[G];return c|=k&f,c}function hn(n,t){if(n===t)return 0n;const e=n%8,o=(n-e)/8,c=t%8,s=(t-c)/8-o,l=c-e,r=s===0?0:s/Math.abs(s),f=l===0?0:l/Math.abs(l),k=1n<<BigInt(n),A=1n<<BigInt(t),g=s>0?d0:K0,a=l>0?W0:O0,E=k|A;if(s===0)return X(k,BigInt(f),a,E)&~A;if(l===0)return X(k,BigInt(r*8),g,E)&~A;if(Math.abs(s)!==Math.abs(l))throw new Error(`No compass direction between ${n} & ${t}`);return X(k,BigInt(r*8+f),g&a,E)&~A}const Cn=Array.from({length:64},()=>Array(64).fill(0n));for(let n=0;n<64;n++){const t=n%8,e=Math.floor(n/8);for(const{df:o,dr:c}of gt){let i=t+o,s=e+c,l=0n;for(;i>=0&&i<8&&s>=0&&s<8;){const r=s*8+i;Cn[n][r]=l,l|=1n<<BigInt(r),i+=o,s+=c}}}function vn(n,t,e){const o=t===0,c=s0(t,n),i=s0(o?1:0,n),s=o?1:0,l=r0(e,i)&Mt(n,s),r=c0(e,i)&mt(n,s);let f=0n;function k(A){let g=A;for(;g;){const a=e0(g);g&=g-1n;const u=Cn[e][a]&c;u!==0n&&(u&u-1n)===0n&&(f|=u)}}return k(l),k(r),f}function Wn(n){const t=n%8,e=Math.floor(n/8);return function(c){const i=c%8,s=Math.floor(c/8),l=i-t,r=s-e,f=l===0?0:l/Math.abs(l),k=r===0?0:r/Math.abs(r),A=f===0||k===0,g=Math.abs(l)===Math.abs(r);if(!(A||g))return 0n;let a=0n,E=t+f,u=e+k;for(;E>=0&&E<8&&u>=0&&u<8;){const m=u*8+E;a|=1n<<BigInt(m),E+=f,u+=k}return a}}const Lt=[1,7,8,9,-1,-7,-8,-9],Nt=n=>{let t=0n;for(const e of Lt){const o=n+e;fn(o)&&Ht(n,o)&&(t|=1n<<BigInt(o))}return t},Ht=(n,t)=>{const e=n%8,o=t%8,c=Math.abs(e-o);return!(c!==1&&c!==0)},Y0=(()=>{const n=new Array(64);for(let t=0;t<64;t++)n[t]=Nt(t);return n})(),pt=(n,t,e,o,c)=>{const i=$(n),s=s0(t,n);let l=r0(e,i);if(1n<<BigInt(e)&o){const f=c(e);l&=f}return l&~s},Ut=(n,t,e,o,c)=>{const i=$(n),s=s0(t,n);let l=c0(e,i)|r0(e,i);if(1n<<BigInt(e)&o){const f=c(e);l&=f}return l&~s},j0=(n,t,e,o,c=null)=>{const i=s0(t,n);let s=Y0[e]&~i;const l=t===0,r=$(n);c&&(l?(c[Q0]&&_n(0,o,r)&&(s|=1n<<6n),c[y0]&&xn(0,o,r)&&(s|=1n<<2n)):(c[G0]&&_n(1,o,r)&&(s|=1n<<62n),c[V0]&&xn(1,o,r)&&(s|=1n<<58n)));const f=1n<<BigInt(e);if(f&o){let k=s;for(;k;){const A=e0(k),g=1n<<BigInt(A);k&=k-1n;let a=r;a&=~f,a|=g;const E=r0(A,a)&(l?n[L]|n[V]:n[P]|n[G]),u=c0(A,a)&(l?n[n0]|n[V]:n[q]|n[G]);(E||u)&&(s&=~g)}}return s&~o},Rt=(n,t,e,o,c,i)=>{const s=1n<<BigInt(e),l=t===0,r=Bt(n),f=l?w0(n):x0(n);let k=0n,A=0n,g=0n,a=0n;if(l){if(k=s<<8n&r,A=(s&0x000000000000ff00n)<<16n&r&r<<8n,g=N0[e]&f,o!==null){const E=1n<<BigInt(o);a=N0[e]&E}}else if(k=s>>8n&r,A=(s&0x00ff000000000000n)>>16n&r&r>>8n,g=H0[e]&f,o!==null){const E=1n<<BigInt(o);a=H0[e]&E}if(c&s){const E=i(e);k&=E,A&=E,g&=E,a&=E}if(a){const E=e0(n[l?H:p]),u=E%8;if((E-u)/8-Math.floor(e/8)===0){const U=o,B=l?U-8:U+8,h=1n<<BigInt(B),v=$(n)&~h&~s,M=n[l?L:P]|n[l?V:G];(Kn(v,E)&M)!==0n&&(a=0n)}}return k|A|g|a},St=(n,t,e,o)=>{if(1n<<BigInt(e)&o)return 0n;let i=X0[e];const s=s0(t,n);return i&~s},Ft=(n,t,e,o,c)=>{const i=$(n),s=s0(t,n);let l=c0(e,i);if(1n<<BigInt(e)&o){const f=c(e);l&=f}return l&~s},On=(n,t,e,o,c,i,s,l,r)=>{let f=null;switch(t){case y:case b:f=Rt(n,o,e,c,l,r);break;case Z:case l0:f=St(n,o,e,l);break;case q:case n0:f=Ft(n,o,e,l,r);break;case P:case L:f=pt(n,o,e,l,r);break;case G:case V:f=Ut(n,o,e,l,r);break;case H:case p:f=j0(n,o,e,s,i);break;default:f=BigInt(0)}return f},g0=(n,t,e,o)=>{let c=[];const i=t===0,l=h0(i?1:0),f=R[i?H:p][0],k=vn(n,t,f),A=Wn(f);let g=~0n;if(l&1n<<BigInt(f)){const E=Tn(n,t,f),u=En(E);if(u>1){const O=j0(n,t,f,l,e);return wn(O,f,i?H:p,o,t)}if(u!==1)throw new Error("KING IN CHECK W/O CHECKERS");const m=e0(E);_[m]%6===Z?g=E:g=hn(f,m)|E}const a=Bn(t);for(const E of a){const u=_[E],m=On(n,u,E,t,o,e,l,k,A),O=P0(u)?m:m&g,U=wn(O,E,u,o,t);c=c.concat(U)}return c},dn=(n,t)=>(t&1n<<BigInt(n))!==0n,p0=(n,t)=>{let e=H,o=1;t===1&&(e=p,o=0);const c=R[e][0],i=h0(o);return dn(c,i)},Qt=(n,t,e,o)=>{const c=t===0,i=c?1:0,s=h0(i),l=c?H:p,r=R[l][0];r===void 0&&(console.log(R[l],l),console.log(Mn(n,t,e,o)));const f=1n<<BigInt(r);if((f&s)===0n&&(Y0[r]&~s&~$(n))!==0n)return!0;const k=vn(n,t,r),A=Wn(r);let g=~0n;if(s&f){const E=Tn(n,t,r),u=En(E);if(u>1)return j0(n,t,r,s,e)!==0n;if(u!==1)throw console.log(Mn(n,t,e,o)),console.log(mn(s)),B0(n),console.log(mn(h0(i))),new Error("KING IN CHECK W/O CHECKERS");const m=e0(E);_[m]%6===Z?g=E:g=hn(r,m)|E}const a=Bn(t);for(const E of a){const u=_[E],m=On(n,u,E,t,o,e,s,k,A);if((P0(u)?m:m&g)!==0n)return!0}return!1},I0=n=>{const t=n.piece;let e=null;if((t===y||t===b)&&Math.abs(n.to-n.from)===16){const o=t===y?-8:8;e=n.to+o}return e};function X(n,t,e,o){let c=0n,i=n;for(;i=(i&e)<<t,!(!i||i===0n);){if(i&o){c|=i;break}c|=i}return c}function yt(n,t){let e=1n<<BigInt(t),o=0n;return o|=X(e,9n,W0&d0,n),o|=X(e,7n,O0&d0,n),o|=X(e,-7n,W0&K0,n),o|=X(e,-9n,O0&K0,n),o}function Kn(n,t){let e=1n<<BigInt(t),o=0n;return o|=X(e,1n,W0,n),o|=X(e,-1n,O0,n),o|=X(e,8n,d0,n),o|=X(e,-8n,K0,n),o}const Pn=Array.from({length:64},(n,t)=>Gt(t)),Ln=Array.from({length:64},(n,t)=>Vt(t));function Nn(n,t){return t*8+n}function Gt(n){const t=n%8,e=Math.floor(n/8);let o=0n;const c=[[0,1],[0,-1],[1,0],[-1,0]];for(const[i,s]of c){let l=t+i,r=e+s;for(;l>=0&&l<8&&r>=0&&r<8;){const f=l+i,k=r+s;if(f>=8||f<0||k>=8||k<0)break;o|=1n<<BigInt(Nn(l,r)),l+=i,r+=s}}return o}function Vt(n){const t=n%8,e=Math.floor(n/8);let o=0n;const c=[[1,1],[-1,1],[1,-1],[-1,-1]];for(const[i,s]of c){let l=t+i,r=e+s;for(;l>0&&l<7&&r>0&&r<7;)o|=1n<<BigInt(Nn(l,r)),l+=i,r+=s}return o}const Z0=[58,59,59,59,59,59,59,58,59,59,59,59,59,59,59,59,59,59,57,57,57,57,59,59,59,59,57,55,55,57,59,59,59,59,57,55,55,57,59,59,59,59,57,57,57,57,59,59,59,59,59,59,59,59,59,59,58,59,59,59,59,59,59,58],Hn=[0x1084200882008102n,0x818102100410000n,0x4064440182010000n,0x8108048110040402n,0x3604102800000108n,0x105042024040010n,0x4140c04260010n,0x8000208a080b4000n,0x40420288120084n,0x200900123040080n,0x8020140104030440n,0x260040400802108n,0x1c2040422000104n,0xa2020510081000n,0x1200084100a1002n,0x20008a20822008n,0x400c001120080102n,0x1020043032008100n,0x2a1002802002201n,0xc001008801490000n,0x2401008811400000n,0x2100800040602002n,0x302000043042002n,0x40820202012111n,0x1402180040084804n,0x228021044240800n,0x208088081040100n,0x528822008020020n,0x111200a0020080c0n,0x2808020480404600n,0x88010044440a00n,0x2002044002840380n,0x402108090020a000n,0x408011008040c41n,0x2021205010800n,0x404018a0120200n,0x40054010030101n,0x4008902100208084n,0x1008408100040905n,0x42004108014420n,0x8250c10022000n,0x2a084104001800n,0x30400a2002414n,0x200041a44000804n,0x4122000e0800c00n,0x1002201045008080n,0x30016801108080n,0x8402040400208080n,0x2801828808410000n,0x81010190040021n,0x300120203044000n,0x406020484240004n,0x4500001006020042n,0x400142428820010n,0x2440050800810004n,0x1842040c003000n,0x8420210090410n,0x200008841082000n,0x4c01000046080401n,0x11008000810c8801n,0x18003400a0042400n,0x20019020114100n,0x100402903010204n,0x4040190401020020n],J0=[52,53,53,53,53,53,52,52,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,52,53,53,53,53,53,53,52],pn=[0x8080008414400221n,0x504000100c200041n,0x1100200010484101n,0x2300200900100004n,0x1000a3500100800n,0x8200030810060004n,0xa00241800a20001n,0x2200009200410024n,0x2820800070844000n,0x38400320005000n,0x200260012c280n,0x2016801000480084n,0x4001000c11010801n,0xa0008c2001004n,0x14000110421804n,0x2025800049000080n,0x440008000482388n,0x801008c004422001n,0x9420008010002480n,0x802a0042002010n,0x401010004880230n,0xc02808004010600n,0xd40042019008n,0x8044220001008044n,0x804080010020c308n,0x8040600280400085n,0xd800200100104102n,0x4007002100100108n,0x1015050100080030n,0x1008540080420080n,0x4000110400221098n,0x818004600008304n,0x440002046800282n,0x100834000802001n,0x1060200501003040n,0x429809000800800n,0x240080c401800800n,0x4002011092000428n,0x400c031004002802n,0x114092000104n,0x8200c00480288004n,0x2810024220064000n,0x39002000110041n,0x3410100100090020n,0x400480091010014n,0x1402001008420064n,0x90a02a0001008080n,0x100400c0820005n,0x8041088040620200n,0x620020d1008200n,0xe60009000208080n,0x80b0018008001080n,0x340808801040080n,0x4409000884000300n,0x18201001c8020400n,0x0000800041000080n,0x2000110040660082n,0x4000210040098011n,0x82000104100a00dn,0x1002084500029n,0x201000c50020801n,0x82001004012822n,0x8008084090210204n,0x102044810406n],D0=Array(64),q0=Array(64);function*Un(n){for(let t=n;yield t,t!==0n;t=t-1n&n);}for(let n=0;n<64;n++){const t=Pn[n],e=Ln[n],o=1<<64-J0[n],c=1<<64-Z0[n];D0[n]=new Array(o),q0[n]=new Array(c);for(const i of Un(t)){const s=i&t,r=BigInt.asUintN(64,s*BigInt(pn[n]))>>BigInt(J0[n]),f=Number(r),k=Kn(i,n);D0[n][f]=k}for(const i of Un(e)){const s=Number(BigInt.asUintN(64,(i&e)*BigInt(Hn[n]))>>BigInt(Z0[n])),l=yt(i,n);q0[n][s]=l}}function c0(n,t){const e=t&Ln[n],o=Number(BigInt.asUintN(64,e*Hn[n])>>BigInt(Z0[n]));return q0[n][o]}function r0(n,t){const e=t&Pn[n],o=Number(BigInt.asUintN(64,e*pn[n])>>BigInt(J0[n]));return D0[n][o]}function zt(n,t,e){switch(t){case y:return N0[e];case b:return H0[e];case Z:case l0:return X0[e];case H:case p:return Y0[e];case q:case n0:return c0(e,n);case P:case L:return r0(e,n);case G:case V:return c0(e,n)|r0(e,n);default:return 0n}}function k0(n,t){let e=0n;const o=R[n];for(const c of o)e|=zt(t,n,c);return e}function B0(n){const t=$(n);for(let e=0;e<Y;e++)j[e]=k0(e,t);return j}const j=new BigUint64Array(Y).fill(0n);B0(Q);class Rn{constructor(t){this.cache=new Map,this.maxSize=t}get(t){if(!this.cache.has(t))return;const e=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,e),e}set(t,e){if(this.cache.has(t))this.cache.delete(t);else if(this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;this.cache.delete(o)}this.cache.set(t,e)}has(t){return this.cache.has(t)}delete(t){return this.cache.delete(t)}clear(){this.cache.clear()}getSize(){return this.cache.size}}const Sn=1<<20,b0=new Rn(Sn),d={EXACT:0,LOWER_BOUND:1,UPPER_BOUND:2},C0=()=>{b0.clear()},nn=n=>b0.get(n),tn=(n,t)=>{b0.set(n,t)},en=new Rn(Sn),Fn=()=>{en.clear()},Qn=n=>en.get(n),yn=(n,t)=>{en.set(n,t)};function i0(){const n=Math.floor(Math.random()*4294967296),t=Math.floor(Math.random()*4294967296);return BigInt(n)<<32n|BigInt(t)}const J=new BigUint64Array(Y*64);for(let n=0;n<Y;n++)for(let t=0;t<64;t++)J[n*64+t]=i0();const on=Array(8).fill(null).map(()=>i0()),$t=[i0(),i0(),i0(),i0()],Gn=i0(),U0=(n,t,e=null,o=null)=>{let c=0n;const i=T0();for(const s of i){const l=_[s];c^=J[l*64+s]}if(t===1&&(c^=Gn),e>=0&&(c^=on[e]),o)for(let s=0;s<o.length;s++)o[s]&&(c^=$t[s]);return c},A0=(n,t,e,o,c)=>{let i=n;const s=t.from,l=t.to,r=t.captured,f=J[t.piece*64+s];i^=f;const k=t.promotion?t.promotion:t.piece,A=J[k*64+l];if(i^=A,r!==null){const g=J[r*64+l];i^=g}if(i^=Gn,e!==o&&(e>=0&&(i^=on[e]),o>=0&&(i^=on[o])),t.castling){const g=s===4,a=g?P:L;if(s>l){const E=g?0:56;i^=J[a*64+E];const u=E+3;i^=J[a*64+u]}else{const E=g?7:63;i^=J[a*64+E];const u=E-2;i^=J[a*64+u]}}for(let g=0;g<c.length;g++)c[g]&&(i^=ut[g]);return i},M0=(n,t,e,o,c)=>{const i=t===0,s=i?1:0,l=h0(t),r={isGameOver:!1,result:null};if(Xt(n))return r.isGameOver=!0,r.result="Draw by Insufficient Material",r;if(Yt(e))return r.isGameOver=!0,r.result="Draw by Repetition",r;if(!Qt(n,s,null,o)){r.isGameOver=!0;const k=R[i?p:H][0];if(dn(k,l)){const A=i?"White":"Black";return r.result=`${A} Wins by Checkmate`,r}return r.result="Draw by Stalemate",r}return r},Xt=n=>{const t=x0(n),e=w0(n),o=n[G]|n[V],c=n[P]|n[L],i=n[y]|n[b];return(o|c|i)!==0n?!1:un(t)<=2&&un(e)<=2},Yt=n=>{for(let t of n.values())if(t>=3)return!0;return!1},jt=[[0,0,0,0,0,0,0,0,5,10,10,-20,-20,10,10,5,5,-5,-10,0,0,-10,-5,5,0,0,10,20,20,0,0,0,5,5,10,25,25,10,5,5,10,10,20,30,30,20,10,10,50,50,50,50,50,50,50,50,0,0,0,0,0,0,0,0],[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,5,5,0,-20,-40,-30,5,20,15,15,20,5,-30,-30,0,15,25,25,15,0,-30,-30,5,15,25,25,15,5,-30,-30,0,10,15,15,10,0,-30,-40,-20,0,0,0,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],[-20,-10,-10,-10,-10,-10,-10,-20,-10,5,0,0,0,0,5,-10,-10,10,10,10,10,10,10,-10,-10,0,10,10,10,10,0,-10,-10,5,5,10,10,5,5,-10,-10,0,5,10,10,5,0,-10,-10,0,0,0,0,0,0,-10,-20,-10,-10,-10,-10,-10,-10,-20],[0,0,5,10,10,5,0,0,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,5,10,10,10,10,10,10,5,0,0,0,0,0,0,0,0],[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,5,0,-10,-10,0,5,5,5,5,5,-10,-5,0,5,5,5,5,0,0,-5,0,5,5,5,5,0,-5,-10,0,5,5,5,5,0,-10,-10,0,0,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],[20,30,10,0,0,10,30,20,20,20,0,0,0,0,20,20,-10,-20,-20,-20,-20,-20,-20,-10,-20,-30,-30,-40,-40,-30,-30,-20,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30],[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,10,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,25,25,15,5,-30,-30,0,15,25,25,15,0,-30,-30,5,20,15,15,20,5,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],[-20,-10,-10,-10,-10,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,10,10,5,0,-10,-10,5,5,10,10,5,5,-10,-10,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,-10,5,0,0,0,0,5,-10,-20,-10,-10,-10,-10,-10,-10,-20],[0,0,0,0,0,0,0,0,5,10,10,10,10,10,10,5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,0,0,0,5,5,0,0,0],[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,5,5,5,0,-10,-5,0,5,5,5,5,0,-5,0,0,5,5,5,5,0,-5,-10,5,5,5,5,5,0,-10,-10,0,5,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,20,20,20,30,10,0,0,10,30,20]],sn=(n,t,e)=>{if(t)return t.includes("Checkmate")?-t0+e:0;let o=0;const c=T0();for(const i of c){const s=_[i],l=s<6?1:-1;o+=l*(m0[s%6]+jt[s][i])}return n===0?o:-o},m0=[100,320,330,500,900,2e4],Vn=(n,t,e)=>g0(n,t,null,e).filter(c=>c.captured!==null||c.promotion),cn=10,zn=Array.from({length:cn},()=>[null,null]),$n=Array.from({length:64},()=>Array(64).fill(0)),Xn=(n,t,e,o,c,i,s,l,r=0)=>{const f=t===0?1:0,k=M0(n,f,s,c);if(k.isGameOver)return{score:sn(f,k.result,0),move:null};const A=sn(t,null,0);if(r+1>cn)return{score:A,move:null};if(A>=o)return{score:o,move:null};const g=e;e=Math.max(e,A);const a=Qn(l),E=cn-r;if(a&&a.depth>=E&&a.isQuiescence){if(a.flag===d.EXACT)return{score:a.value,move:null};if(a.flag===d.LOWER_BOUND&&a.value>e?e=a.value:a.flag===d.UPPER_BOUND&&a.value<o&&(o=a.value),e>=o)return{score:a.value,move:null}}const u=(a==null?void 0:a.bestMove)||null,m=Vn(n,t,c).map(B=>{let h=0;const v=B.from,M=B.to;u&&v===u.from&&M===u.to&&(h+=1e6),B.captured&&(h+=1e5+(m0[B.captured%6]||0)-(m0[B.piece%6]||0));const[I,x]=zn[r];return I&&v===I.from&&M===I.to?h+=9e4:x&&v===x.from&&M===x.to&&(h+=8e4),h+=$n[v][M],{move:B,score:h}});m.sort((B,h)=>h.score-B.score);const O=m.map(B=>B.move);for(const B of O){const h=m0[B.captured%6]||0;if(A+h<=e)continue;a0(n,B);const v=I0(B),M=u0(B.from,B.to,i),I=v?v%8:-1,x=c?c%8:-1,C=new Array(M.length);for(let T=0;T<M.length;T++)i[T]!==M[T]?C[T]=!0:C[T]=!1;const w=A0(l,B,I,x,C),W=s.get(w)||0;s.set(w,W+1);const{score:F}=Xn(n,f,-o,-e,v,M,s,w,r+1);E0(B,n),W?s.set(w,W):s.delete(w);const S=-F;if(S>=o)return{score:o,move:null};if(S>e&&(e=S),o<=e){if(B.captured===null){const T=zn[r];(!T[0]||B.from!==T[0].from||B.to!==T[0].to)&&(T[1]=T[0],T[0]=B),$n[B.from][B.to]+=2^E}break}}let U=d.EXACT;return e<=g?U=d.UPPER_BOUND:e>=o&&(U=d.LOWER_BOUND),yn(l,{value:e,depth:E,flag:U,isQuiescence:!0}),{score:e,move:null}},Yn=Array.from({length:z0},()=>[null,null]),jn=Array.from({length:64},()=>Array(64).fill(0)),Zn=(n,t,e,o,c,i,s,l,r,f)=>{const k=t===0?1:0,A=M0(n,k,c,o);if(A.isGameOver)return{score:sn(k,A.result,s),move:null};if(s>=l&&(!p0(n,t)||s!==l))return{score:Xn(n,t,r,f,o,e,c,i).score,move:null};const g=i,a=r,E=l-s,u=nn(g);if(u&&u.depth>=E&&u.rootId===R0){if(u.flag===d.EXACT)return{score:u.value,move:u.bestMove};if(u.flag===d.LOWER_BOUND&&(r=Math.max(r,u.value)),u.flag===d.UPPER_BOUND&&(f=Math.min(f,u.value)),r>=f)return{score:u.value,move:u.bestMove}}const m=(u==null?void 0:u.bestMove)||null,O=g0(n,t,e,o).map(I=>{let x=0;const C=I.from,w=I.to;m&&C===m.from&&w===m.to&&(x+=1e6),I.captured&&(x+=1e5+(m0[I.captured%6]||0)-(m0[I.piece%6]||0));const[W,F]=Yn[s];return W&&C===W.from&&w===W.to?x+=9e4:F&&C===F.from&&w===F.to&&(x+=8e4),x+=jn[C][w],{move:I,score:x}});if(O.length===0)throw new Error("Issue with move generation. No moves generated");O.sort((I,x)=>x.score-I.score);const U=O.map(I=>I.move);let B=-1/0,h=null;for(const I of U){a0(n,I);const x=I.from,C=I0(I),w=u0(x,I.to,e),W=C?C%8:-1,F=o?o%8:-1,S=new Array(w.length);for(let K=0;K<w.length;K++)e[K]!==w[K]?S[K]=!0:S[K]=!1;const T=A0(i,I,W,F,S),D=c.get(T)||0;c.set(T,D+1);const{score:o0}=Zn(n,k,w,C,c,T,s+1,l,-f,-r);E0(I,n),D?c.set(T,D):c.delete(T);const N=-o0;if(N>B&&(B=N,h=I),N>r&&(r=N),f<=r){if(I.captured===null){const K=Yn[s];(!K[0]||I.from!==K[0].from||I.to!==K[0].to)&&(K[1]=K[0],K[0]=I),jn[I.from][I.to]+=2^l-s}break}}let v=d.EXACT;const M=B;return M<=a?v=d.UPPER_BOUND:M>=f&&(v=d.LOWER_BOUND),tn(g,{rootId:R0,depth:l-s,value:M,flag:v,bestMove:h}),{score:B,move:h}};let R0=0;function Zt(n,t,e,o,c,i,s=1/0){C0(),Fn();const l=performance.now();let r=null,f=null;const k=o?o%8:-1,A=U0(n,t,k,e);R0=0;for(let g=1;g<=i;g++){const{score:a,move:E}=Zn(n,t,e,o,c,A,0,g,-1/0,1/0);if(E!==null&&(f=a,r=E),Math.abs(a)>t0-g&&E||performance.now()-l>s)break;R0++}return{...r,bestEval:f}}const v0=Object.freeze({BMV1:"BMV1",BMV2:"BMV2",BMV3:"BMV3",BMV4:"BMV4",BMV5:"BMV5"}),Jn=(n,t,e)=>{if(t)return t.includes("Checkmate")?-t0+e:0;let o=0;const c=T0();for(const i of c){const s=_[i];o+=f0[s]}return n===0?o:-o},Dn=(n,t,e,o,c,i,s,l,r,f)=>{const k=t===0?1:0,A=M0(n,k,c,o);if(A.isGameOver)return{score:Jn(k,A.result,s),move:null};if(s>=l&&(!p0(n,t)||s!==l))return{score:Jn(t,A.result,s),move:null};const g=g0(n,t,e,o).map(m=>{let O=0;return m.captured&&(O+=(f0[m.captured%6]||0)-(f0[m.piece%6]||0)),{move:m,score:O}});if(g.length===0)throw new Error("Issue with move generation. No moves generated");g.sort((m,O)=>O.score-m.score);const a=g.map(m=>m.move);let E=-1/0,u=null;for(const m of a){a0(n,m);const O=m.from,U=I0(m),B=u0(O,m.to,e),h=new Map(c),v=U?U%8:-1,M=o?o%8:-1,I=new Array(B.length);for(let W=0;W<B.length;W++)e[W]!==B[W]?I[W]=!0:I[W]=!1;const x=A0(i,m,v,M,I);h.set(x,(h.get(x)||0)+1);const{score:C}=Dn(n,k,B,U,h,x,s+1,l,-f,-r);E0(m,n);const w=-C;if(w>E&&(E=C,u=m),w>r&&(r=w),f<=r)break}return{score:E,move:u}};function Jt(n,t,e,o,c,i,s=1/0){C0();const l=performance.now();let r=null,f=null;const k=o?o%8:-1,A=U0(n,t,k,e);for(let g=1;g<=i;g++){B0(n);const{score:a,move:E}=Dn(n,t,e,o,c,A,0,g,-1/0,1/0);if(E!=null&&(r=E,f=a),Math.abs(a)>t0-g&&E)break;if(performance.now()-l>s){console.log("time limit");break}}return{...r,bestEval:f}}const qn=(n,t,e)=>{if(t)return t.includes("Checkmate")?-t0+e:0;let o=0;const c=T0();for(const i of c){const s=_[i];o+=f0[s]}return n===0?o:-o},bn=Array.from({length:z0},()=>[null,null]),nt=Array.from({length:64},()=>Array(64).fill(0)),tt=(n,t,e,o,c,i,s,l,r,f)=>{const k=t===0?1:0,A=M0(n,k,c,o);if(A.isGameOver)return{score:qn(k,A.result,s),move:null};if(s>=l&&(!p0(n,t)||s!==l))return{score:qn(t,A.result,s),move:null};const g=i,a=r,E=l-s,u=nn(g);if(u&&u.depth>=E&&u.rootId===S0){if(u.flag===d.EXACT)return{score:u.value,move:u.bestMove};if(u.flag===d.LOWER_BOUND&&(r=Math.max(r,u.value)),u.flag===d.UPPER_BOUND&&(f=Math.min(f,u.value)),r>=f)return{score:u.value,move:u.bestMove}}const m=(u==null?void 0:u.bestMove)||null,O=g0(n,t,e,o).map(M=>{let I=0;const x=M.from,C=M.to;m&&x===m.from&&C===m.to&&(I+=1e6),M.captured&&(I+=1e5+(f0[M.captured%6]||0)-(f0[M.piece%6]||0));const[w,W]=bn[s];return w&&x===w.from&&C===w.to?I+=9e4:W&&x===W.from&&C===W.to&&(I+=8e4),I+=nt[x][C],{move:M,score:I}});if(O.length===0)throw new Error("Issue with move generation. No moves generated");O.sort((M,I)=>I.score-M.score);const U=O.map(M=>M.move);let B=-1/0,h=null;for(const M of U){a0(n,M);const I=M.from,x=I0(M),C=u0(I,M.to,e),w=new Map(c),W=x?x%8:-1,F=o?o%8:-1,S=new Array(C.length);for(let N=0;N<C.length;N++)e[N]!==C[N]?S[N]=!0:S[N]=!1;const T=A0(i,M,W,F,S);w.set(T,(w.get(T)||0)+1);const{score:D}=tt(n,k,C,x,w,T,s+1,l,-f,-r);E0(M,n);const o0=-D;if(o0>B&&(B=o0,h=M),o0>r&&(r=o0),f<=r){if(M.captured===null){const N=bn[s];(!N[0]||M.from!==N[0].from||M.to!==N[0].to)&&(N[1]=N[0],N[0]=M),nt[M.from][M.to]+=2^l-s}break}}let v=d.EXACT;return B<=a?v=d.UPPER_BOUND:B>=f&&(v=d.LOWER_BOUND),tn(g,{rootId:S0,depth:l-s,value:B,flag:v,bestMove:h}),{score:B,move:h}};let S0=0;function Dt(n,t,e,o,c,i,s=1/0){C0();const l=performance.now();let r=null,f=null;const k=o?o%8:-1,A=U0(n,t,k,e);S0=0;for(let g=1;g<=i;g++){B0(n);const{score:a,move:E}=tt(n,t,e,o,c,A,0,g,-1/0,1/0);if(E!=null&&(f=a,r=E),Math.abs(a)>t0-g&&E)break;if(performance.now()-l>s){console.log("time limit");break}S0++}return{...r,bestEval:f}}const rn=(n,t,e)=>{if(t)return t.includes("Checkmate")?-t0+e:0;let o=0;const c=T0();for(const i of c){const s=_[i],l=s<6?1:-1;o+=l*_0[s%6]}return n===0?o:-o},_0=[100,320,330,500,900,2e4],ln=6,et=Array.from({length:ln},()=>[null,null]),ot=Array.from({length:64},()=>Array(64).fill(0)),st=(n,t,e,o,c,i,s,l,r=0)=>{const f=t===0?1:0,k=M0(n,f,s,c);if(k.isGameOver)return{score:rn(f,k.result,0),move:null};const A=rn(t,null,0);if(r+1>ln)return{score:A,move:null};if(A>=o)return{score:o,move:null};const g=e;e=Math.max(e,A);const a=Qn(l),E=ln-r;if(a&&a.depth>=E&&a.isQuiescence){if(a.flag===d.EXACT)return{score:a.value,move:null};if(a.flag===d.LOWER_BOUND&&a.value>e?e=a.value:a.flag===d.UPPER_BOUND&&a.value<o&&(o=a.value),e>=o)return{score:a.value,move:null}}const u=(a==null?void 0:a.bestMove)||null,m=Vn(n,t,c).map(B=>{let h=0;const v=B.from,M=B.to;u&&v===u.from&&M===u.to&&(h+=1e6),B.captured&&(h+=1e5+(_0[B.captured%6]||0)-(_0[B.piece%6]||0));const[I,x]=et[r];return I&&v===I.from&&M===I.to?h+=9e4:x&&v===x.from&&M===x.to&&(h+=8e4),h+=ot[v][M],{move:B,score:h}});m.sort((B,h)=>h.score-B.score);const O=m.map(B=>B.move);for(const B of O){const h=_0[B.captured%6]||0;if(A+h<=e)continue;a0(n,B);const v=I0(B),M=u0(B.from,B.to,i),I=v?v%8:-1,x=c?c%8:-1,C=new Array(M.length);for(let T=0;T<M.length;T++)i[T]!==M[T]?C[T]=!0:C[T]=!1;const w=A0(l,B,I,x,C),W=s.get(w)||0;s.set(w,W+1);const{score:F}=st(n,f,-o,-e,v,M,s,w,r+1);E0(B,n),W?s.set(w,W):s.delete(w);const S=-F;if(S>=o)return{score:o,move:null};if(S>e&&(e=S),o<=e){if(B.captured===null){const T=et[r];(!T[0]||B.from!==T[0].from||B.to!==T[0].to)&&(T[1]=T[0],T[0]=B),ot[B.from][B.to]+=2^E}break}}let U=d.EXACT;return e<=g?U=d.UPPER_BOUND:e>=o&&(U=d.LOWER_BOUND),yn(l,{value:e,depth:E,flag:U,isQuiescence:!0}),{score:e,move:null}},ct=Array.from({length:z0},()=>[null,null]),rt=Array.from({length:64},()=>Array(64).fill(0)),it=(n,t,e,o,c,i,s,l,r,f)=>{const k=t===0?1:0,A=M0(n,k,c,o);if(A.isGameOver)return{score:rn(k,A.result,s),move:null};if(s>=l&&(!p0(n,t)||s!==l))return{score:st(n,t,r,f,o,e,c,i).score,move:null};const g=i,a=r,E=l-s,u=nn(g);if(u&&u.depth>=E&&u.rootId===F0){if(u.flag===d.EXACT)return{score:u.value,move:u.bestMove};if(u.flag===d.LOWER_BOUND&&(r=Math.max(r,u.value)),u.flag===d.UPPER_BOUND&&(f=Math.min(f,u.value)),r>=f)return{score:u.value,move:u.bestMove}}const m=(u==null?void 0:u.bestMove)||null,O=g0(n,t,e,o).map(I=>{let x=0;const C=I.from,w=I.to;m&&C===m.from&&w===m.to&&(x+=1e6),I.captured&&(x+=1e5+(_0[I.captured%6]||0)-(_0[I.piece%6]||0));const[W,F]=ct[s];return W&&C===W.from&&w===W.to?x+=9e4:F&&C===F.from&&w===F.to&&(x+=8e4),x+=rt[C][w],{move:I,score:x}});if(O.length===0)throw new Error("Issue with move generation. No moves generated");O.sort((I,x)=>x.score-I.score);const U=O.map(I=>I.move);let B=-1/0,h=null;for(const I of U){a0(n,I);const x=I.from,C=I0(I),w=u0(x,I.to,e),W=C?C%8:-1,F=o?o%8:-1,S=new Array(w.length);for(let K=0;K<w.length;K++)e[K]!==w[K]?S[K]=!0:S[K]=!1;const T=A0(i,I,W,F,S),D=c.get(T)||0;c.set(T,D+1);const{score:o0}=it(n,k,w,C,c,T,s+1,l,-f,-r);E0(I,n),D?c.set(T,D):c.delete(T);const N=-o0;if(N>B&&(B=N,h=I),N>r&&(r=N),f<=r){if(I.captured===null){const K=ct[s];(!K[0]||I.from!==K[0].from||I.to!==K[0].to)&&(K[1]=K[0],K[0]=I),rt[I.from][I.to]+=2^l-s}break}}let v=d.EXACT;const M=B;return M<=a?v=d.UPPER_BOUND:M>=f&&(v=d.LOWER_BOUND),tn(g,{rootId:F0,depth:l-s,value:M,flag:v,bestMove:h}),{score:B,move:h}};let F0=0;function qt(n,t,e,o,c,i,s=1/0){C0(),Fn();const l=performance.now();let r=null,f=null;const k=o?o%8:-1,A=U0(n,t,k,e);F0=0;for(let g=1;g<=i;g++){B0(n);const{score:a,move:E}=it(n,t,e,o,c,A,0,g,-1/0,1/0);if(E!==null&&(f=a,r=E),Math.abs(a)>t0-g&&E||performance.now()-l>s)break;F0++}return{...r,bestEval:f}}const bt=(n,t,e,o,c=new Map,i=0,s=1/0)=>{const l=g0(n,t,e,o);return l[Math.floor(Math.random()*l.length)]},ne={[v0.BMV1]:bt,[v0.BMV2]:Jt,[v0.BMV3]:Dt,[v0.BMV4]:qt,[v0.BMV5]:Zt};onmessage=n=>{const{bitboards:t,player:e,castlingRights:o,enPassantSquare:c,prevPositions:i,engine:s,maxDepth:l,timeLimit:r}=n.data;C0(),An(t),gn(t),B0(t);const f=ne[s],k=f(t,e,o,c,i,l,r);postMessage({move:k})}})();
