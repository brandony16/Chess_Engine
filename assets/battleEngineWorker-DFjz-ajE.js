(function(){"use strict";const Cn=n=>{let e;const t=new Set,o=(f,a)=>{const m=typeof f=="function"?f(e):f;if(!Object.is(m,e)){const d=e;e=a??(typeof m!="object"||m===null)?m:Object.assign({},e,m),t.forEach(u=>u(e,d))}},s=()=>e,l={setState:o,getState:s,getInitialState:()=>i,subscribe:f=>(t.add(f),()=>t.delete(f))},i=e=n(o,s,l);return l},je=n=>n?Cn(n):Cn;function ze(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var On={exports:{}},C={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var C0=Symbol.for("react.element"),De=Symbol.for("react.portal"),Xe=Symbol.for("react.fragment"),qe=Symbol.for("react.strict_mode"),Ye=Symbol.for("react.profiler"),Je=Symbol.for("react.provider"),Ze=Symbol.for("react.context"),be=Symbol.for("react.forward_ref"),nt=Symbol.for("react.suspense"),et=Symbol.for("react.memo"),tt=Symbol.for("react.lazy"),Sn=Symbol.iterator;function ot(n){return n===null||typeof n!="object"?null:(n=Sn&&n[Sn]||n["@@iterator"],typeof n=="function"?n:null)}var Pn={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},Tn=Object.assign,Nn={};function I0(n,e,t){this.props=n,this.context=e,this.refs=Nn,this.updater=t||Pn}I0.prototype.isReactComponent={},I0.prototype.setState=function(n,e){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,e,"setState")},I0.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function Rn(){}Rn.prototype=I0.prototype;function J0(n,e,t){this.props=n,this.context=e,this.refs=Nn,this.updater=t||Pn}var Z0=J0.prototype=new Rn;Z0.constructor=J0,Tn(Z0,I0.prototype),Z0.isPureReactComponent=!0;var Ln=Array.isArray,Un=Object.prototype.hasOwnProperty,b0={current:null},Kn={key:!0,ref:!0,__self:!0,__source:!0};function Wn(n,e,t){var o,s={},c=null,r=null;if(e!=null)for(o in e.ref!==void 0&&(r=e.ref),e.key!==void 0&&(c=""+e.key),e)Un.call(e,o)&&!Kn.hasOwnProperty(o)&&(s[o]=e[o]);var l=arguments.length-2;if(l===1)s.children=t;else if(1<l){for(var i=Array(l),f=0;f<l;f++)i[f]=arguments[f+2];s.children=i}if(n&&n.defaultProps)for(o in l=n.defaultProps,l)s[o]===void 0&&(s[o]=l[o]);return{$$typeof:C0,type:n,key:c,ref:r,props:s,_owner:b0.current}}function st(n,e){return{$$typeof:C0,type:n.type,key:e,ref:n.ref,props:n.props,_owner:n._owner}}function nn(n){return typeof n=="object"&&n!==null&&n.$$typeof===C0}function rt(n){var e={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(t){return e[t]})}var Fn=/\/+/g;function en(n,e){return typeof n=="object"&&n!==null&&n.key!=null?rt(""+n.key):e.toString(36)}function U0(n,e,t,o,s){var c=typeof n;(c==="undefined"||c==="boolean")&&(n=null);var r=!1;if(n===null)r=!0;else switch(c){case"string":case"number":r=!0;break;case"object":switch(n.$$typeof){case C0:case De:r=!0}}if(r)return r=n,s=s(r),n=o===""?"."+en(r,0):o,Ln(s)?(t="",n!=null&&(t=n.replace(Fn,"$&/")+"/"),U0(s,e,t,"",function(f){return f})):s!=null&&(nn(s)&&(s=st(s,t+(!s.key||r&&r.key===s.key?"":(""+s.key).replace(Fn,"$&/")+"/")+n)),e.push(s)),1;if(r=0,o=o===""?".":o+":",Ln(n))for(var l=0;l<n.length;l++){c=n[l];var i=o+en(c,l);r+=U0(c,e,t,i,s)}else if(i=ot(n),typeof i=="function")for(n=i.call(n),l=0;!(c=n.next()).done;)c=c.value,i=o+en(c,l++),r+=U0(c,e,t,i,s);else if(c==="object")throw e=String(n),Error("Objects are not valid as a React child (found: "+(e==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":e)+"). If you meant to render a collection of children, use an array instead.");return r}function K0(n,e,t){if(n==null)return n;var o=[],s=0;return U0(n,o,"","",function(c){return e.call(t,c,s++)}),o}function ct(n){if(n._status===-1){var e=n._result;e=e(),e.then(function(t){(n._status===0||n._status===-1)&&(n._status=1,n._result=t)},function(t){(n._status===0||n._status===-1)&&(n._status=2,n._result=t)}),n._status===-1&&(n._status=0,n._result=e)}if(n._status===1)return n._result.default;throw n._result}var $={current:null},W0={transition:null},it={ReactCurrentDispatcher:$,ReactCurrentBatchConfig:W0,ReactCurrentOwner:b0};function Qn(){throw Error("act(...) is not supported in production builds of React.")}C.Children={map:K0,forEach:function(n,e,t){K0(n,function(){e.apply(this,arguments)},t)},count:function(n){var e=0;return K0(n,function(){e++}),e},toArray:function(n){return K0(n,function(e){return e})||[]},only:function(n){if(!nn(n))throw Error("React.Children.only expected to receive a single React element child.");return n}},C.Component=I0,C.Fragment=Xe,C.Profiler=Ye,C.PureComponent=J0,C.StrictMode=qe,C.Suspense=nt,C.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=it,C.act=Qn,C.cloneElement=function(n,e,t){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var o=Tn({},n.props),s=n.key,c=n.ref,r=n._owner;if(e!=null){if(e.ref!==void 0&&(c=e.ref,r=b0.current),e.key!==void 0&&(s=""+e.key),n.type&&n.type.defaultProps)var l=n.type.defaultProps;for(i in e)Un.call(e,i)&&!Kn.hasOwnProperty(i)&&(o[i]=e[i]===void 0&&l!==void 0?l[i]:e[i])}var i=arguments.length-2;if(i===1)o.children=t;else if(1<i){l=Array(i);for(var f=0;f<i;f++)l[f]=arguments[f+2];o.children=l}return{$$typeof:C0,type:n.type,key:s,ref:c,props:o,_owner:r}},C.createContext=function(n){return n={$$typeof:Ze,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Je,_context:n},n.Consumer=n},C.createElement=Wn,C.createFactory=function(n){var e=Wn.bind(null,n);return e.type=n,e},C.createRef=function(){return{current:null}},C.forwardRef=function(n){return{$$typeof:be,render:n}},C.isValidElement=nn,C.lazy=function(n){return{$$typeof:tt,_payload:{_status:-1,_result:n},_init:ct}},C.memo=function(n,e){return{$$typeof:et,type:n,compare:e===void 0?null:e}},C.startTransition=function(n){var e=W0.transition;W0.transition={};try{n()}finally{W0.transition=e}},C.unstable_act=Qn,C.useCallback=function(n,e){return $.current.useCallback(n,e)},C.useContext=function(n){return $.current.useContext(n)},C.useDebugValue=function(){},C.useDeferredValue=function(n){return $.current.useDeferredValue(n)},C.useEffect=function(n,e){return $.current.useEffect(n,e)},C.useId=function(){return $.current.useId()},C.useImperativeHandle=function(n,e,t){return $.current.useImperativeHandle(n,e,t)},C.useInsertionEffect=function(n,e){return $.current.useInsertionEffect(n,e)},C.useLayoutEffect=function(n,e){return $.current.useLayoutEffect(n,e)},C.useMemo=function(n,e){return $.current.useMemo(n,e)},C.useReducer=function(n,e,t){return $.current.useReducer(n,e,t)},C.useRef=function(n){return $.current.useRef(n)},C.useState=function(n){return $.current.useState(n)},C.useSyncExternalStore=function(n,e,t){return $.current.useSyncExternalStore(n,e,t)},C.useTransition=function(){return $.current.useTransition()},C.version="18.3.1",On.exports=C;var lt=On.exports,Hn=ze(lt);const ft=n=>n;function ut(n,e=ft){const t=Hn.useSyncExternalStore(n.subscribe,()=>e(n.getState()),()=>e(n.getInitialState()));return Hn.useDebugValue(t),t}const Vn=n=>{const e=je(n),t=o=>ut(e,o);return Object.assign(t,e),t},at=n=>n?Vn(n):Vn,_=0,H=1,q={wP:0,wN:1,wB:2,wR:3,wQ:4,wK:5,bP:6,bN:7,bB:8,bR:9,bQ:10,bK:11},Z=12,j=0,n0=1,s0=2,R=3,z=4,W=5,e0=6,_0=7,r0=8,L=9,D=10,F=11,U=new BigUint64Array(Z);U[q.wP]=BigInt("0x000000000000FF00"),U[q.wN]=BigInt("0x0000000000000042"),U[q.wB]=BigInt("0x0000000000000024"),U[q.wR]=BigInt("0x0000000000000081"),U[q.wQ]=BigInt("0x0000000000000008"),U[q.wK]=BigInt("0x0000000000000010"),U[q.bP]=BigInt("0x00FF000000000000"),U[q.bN]=BigInt("0x4200000000000000"),U[q.bB]=BigInt("0x2400000000000000"),U[q.bR]=BigInt("0x8100000000000000"),U[q.bQ]=BigInt("0x0800000000000000"),U[q.bK]=BigInt("0x1000000000000000");const F0=0x7f7f7f7f7f7f7f7fn,Q0=0xfefefefefefefefen,H0=0x00ffffffffffffffn,V0=0xffffffffffffff00n,gt={0:"P",1:"N",2:"B",3:"R",4:"Q",5:"K",6:"p",7:"n",8:"b",9:"r",10:"q",11:"k"},dt={0:"P",1:"N",2:"B",3:"R",4:"Q",5:"K",6:"P",7:"N",8:"B",9:"R",10:"Q",11:"K"},tn={0:"a",1:"b",2:"c",3:"d",4:"e",5:"f",6:"g",7:"h"},Et={a:0,b:1,c:2,d:3,e:4,f:5,g:6,h:7},mt=[0xabc123n,0xdef456n,0x789abcn,0x123defn],on=0,sn=1,rn=2,cn=3,h0=[1,3,3,5,9,1e3,-1,-3,-3,-5,-9,-1e3],c0=1e5,ln=32,kt=[z,R,s0,n0],pt=[D,L,r0,_0],Bt=[{df:1,dr:0},{df:-1,dr:0},{df:0,dr:1},{df:0,dr:-1},{df:1,dr:1},{df:-1,dr:1},{df:1,dr:-1},{df:-1,dr:-1}],Gn=n=>n>=0&&n<64,Mt=0x03f79d71b4cb0a89n,It=[0,1,48,2,57,49,28,3,61,58,50,42,38,29,17,4,62,55,59,36,53,51,43,22,45,39,33,30,24,18,12,5,63,47,56,27,60,41,37,16,54,35,52,21,44,32,23,11,46,26,40,15,34,20,31,10,25,14,19,9,13,8,7,6],i0=n=>{if(n===0n)return-1;const e=n&-n,t=BigInt.asUintN(64,e*Mt),o=Number(t>>58n);return It[o]},$n=n=>{let e=0;for(;n;)n&=n-1n,e++;return e},O0=n=>n===W||n===F,jn=n=>!(n%6===j||n%6===n0||O0(n));function zn(n){let e=0;for(;n!==0n;)n&=n-1n,e++;return e}const S0=n=>n[j]|n[n0]|n[s0]|n[R]|n[z]|n[W],P0=n=>n[e0]|n[_0]|n[r0]|n[L]|n[D]|n[F],Y=n=>BigInt(S0(n)|P0(n)),u0=(n,e)=>n===_?S0(e):P0(e),_t=n=>~(S0(n)|P0(n)),I=new Array(64).fill(null);function fn(n){ht();for(let e=0;e<Z;e++){let t=n[e];for(;t;){const o=i0(t);I[o]=e,t&=t-1n}}}function ht(){for(let n=0;n<64;n++)I[n]=null}fn(U);function At(n,e){return e===_?n[R]|n[z]:n[L]|n[D]}function xt(n,e){return e===_?n[s0]|n[z]:n[r0]|n[D]}const Q=Array.from({length:Z},()=>[]);un(U);function Dn(n){const{piece:e,from:t,to:o,captured:s,promotion:c,enPassant:r,castling:l}=n,i=Q[e];if(c!==null?(Q[c].push(o),i.splice(i.indexOf(t),1)):i[i.indexOf(t)]=o,s!==null){const f=Q[s];if(r){const a=o>t?o-8:o+8;f.splice(f.indexOf(a),1)}else f.splice(f.indexOf(o),1)}if(l)if(t===4){const f=Q[R];o===6?f[f.indexOf(7)]=5:f[f.indexOf(0)]=3}else{const f=Q[L];o===62?f[f.indexOf(63)]=61:f[f.indexOf(56)]=59}}function Xn(n){const{piece:e,from:t,to:o,captured:s,promotion:c,enPassant:r,castling:l}=n,i=Q[e];if(c){const f=Q[c];f.splice(f.indexOf(o),1),i.push(t)}else i[i.indexOf(o)]=t;if(s!==null){const f=Q[s];if(r){const a=o>t?o-8:o+8;f.push(a)}else f.push(o)}if(l)if(t===4){const f=Q[R];o===6?f[f.indexOf(5)]=7:f[f.indexOf(3)]=0}else{const f=Q[L];o===62?f[f.indexOf(61)]=63:f[f.indexOf(59)]=56}}function qn(n){const e=n===_?0:6,t=[];for(let o=e;o<e+6;o++)t.push(...Q[o]);return t}function T0(){let n=[];for(let e=0;e<Z;e++)n.push(...Q[e]);return n}function un(n){for(let e=0;e<Z;e++)Q[e].length=0;for(let e=0;e<Z;e++){let t=n[e];const o=Q[e];for(;t;){const s=i0(t);o.push(s),t&=t-1n}}}function Yn(n){let e="";for(let t=7;t>=0;t--){let o="";for(let s=0;s<8;s++){let c=BigInt(1)<<BigInt(t*8+s);o+=n&c?"1 ":"0 "}e+=o.trim()+`
`}return e}function Jn(n,e,t,o){const s=[];for(let m=7;m>=0;m--){let d="",u=0;for(let E=0;E<8;E++){const g=m*8+E,B=I[g];B===null?u+=1:(u&&(d+=u,u=0),d+=gt[B])}u&&(d+=u),s.push(d)}const c=s.join("/"),r=e===_?"w":"b",l="-",i=o!==null?wt(o):"-";return`${c} ${r} ${l} ${i} 0 1`}function wt(n){const e=Math.floor(n/8)+1,t=n%8;return""+tn[t]+e}function Zn(n){const e=n.charAt(0),t=n.charAt(1),o=parseInt(t)-1,s=Et[e];return o*8+s}async function vt(){const n=await fetch("../../../openings.json");if(!n.ok)throw new Error("Error fetching opening moves");const e=await n.json(),t=Math.floor(Math.random()*e.length);return e[t]}class G0{constructor(e,t,o,s,c,r,l){this.from=e,this.to=t,this.piece=o,this.captured=s,this.promotion=c,this.castling=r,this.enPassant=l}copyWith({from:e,to:t,piece:o,captured:s,promotion:c,castling:r,enPassant:l}){return new G0(e??this.from,t??this.to,o??this.piece,s??this.captured,c??this.promotion,r??this.castling,l??this.enPassant)}}const a0=(n,e)=>{const t=1n,o=t<<BigInt(e.from),s=t<<BigInt(e.to),c=e.piece,r=e.captured,l=e.promotion,i=e.enPassant;if(Y(n),e.castling){Yt(n,e);return}if(n[c]&=~o,e.captured!==null&&!i&&(n[r]&=~s),I[e.from]=null,l?(n[l]|=s,I[e.to]=l):(n[c]|=s,I[e.to]=c),i){const f=c===j?-8:8;n[r]&=~(t<<BigInt(e.to+f)),I[e.to+f]=null}Dn(e),z0(n,e)},A0=(n,e)=>{const t=n.from,o=n.to,s=1n,c=s<<BigInt(t),r=s<<BigInt(o),l=n.piece,i=n.captured,f=n.promotion,a=n.enPassant;if(n.castling){Jt(e,n);return}if(I[o]=null,I[t]=l,f?(e[f]&=~r,e[l]|=c):(e[l]&=~r,e[l]|=c),i!==null&&!a&&(e[i]|=r,I[o]=i),a){const d=o+(l===j?-8:8);e[i]|=s<<BigInt(d),I[d]=i}Xn(n),z0(e,n)},yt=(n,e,t,o)=>{const s=t<=5,c=O0(t)&&Math.abs(n-e)===2,r=e===o&&(t===j||t===e0);let l=I[e];return r&&(l=s?e0:j),new G0(n,e,t,l,null,c,r)},bn=(n,e,t,o,s)=>{const c=[],r=s===_?6:1,i=Math.floor(e/8)===r&&t%6===j;let f=n;for(;f!==0n;){const a=i0(f);f&=f-1n;const m=yt(e,a,t,o);if(i){const d=s===_?kt:pt;for(const u of d){const E=m.copyWith({promotion:u});c.push(E)}}else c.push(m)}return c},Ct=n=>{const e=1n<<BigInt(n);let t=0n;return n%8!==0&&(t|=e<<7n),n%8!==7&&(t|=e<<9n),t},Ot=n=>{const e=1n<<BigInt(n);let t=0n;return n%8!==0&&(t|=e>>9n),n%8!==7&&(t|=e>>7n),t},$0=(()=>{const n=new Array(64);for(let e=0;e<64;e++)n[e]=Ct(e);return n})(),j0=(()=>{const n=new Array(64);for(let e=0;e<64;e++)n[e]=Ot(e);return n})(),St=[17,15,10,6,-17,-15,-10,-6],Pt=n=>{let e=0n;for(const t of St){const o=n+t;Gn(o)&&Tt(n,o)&&(e|=1n<<BigInt(o))}return e},Tt=(n,e)=>{const t=n%8,o=e%8,s=Math.abs(t-o);return!(s!==1&&s!==2)},an=(()=>{const n=new Array(64);for(let e=0;e<64;e++)n[e]=Pt(e);return n})();function ne(n,e,t){const o=e===_,s=n[o?e0:j],c=(o?$0[t]:j0[t])&s,r=n[o?_0:n0],l=an[t]&r,i=Nt(n,t,Y(n),o);return c|l|i}function Nt(n,e,t,o){let s=0n,r=E0(e,t)&t;const l=o?n[L]|n[D]:n[R]|n[z];s|=r&l;let f=d0(e,t)&t;const a=o?n[r0]|n[D]:n[s0]|n[z];return s|=a&f,s}function ee(n,e){if(n===e)return 0n;const t=n%8,o=(n-t)/8,s=e%8,r=(e-s)/8-o,l=s-t,i=r===0?0:r/Math.abs(r),f=l===0?0:l/Math.abs(l),a=1n<<BigInt(n),m=1n<<BigInt(e),d=r>0?H0:V0,u=l>0?F0:Q0,E=a|m;if(r===0)return J(a,BigInt(f),u,E)&~m;if(l===0)return J(a,BigInt(i*8),d,E)&~m;if(Math.abs(r)!==Math.abs(l))throw new Error(`No compass direction between ${n} & ${e}`);return J(a,BigInt(i*8+f),d&u,E)&~m}const te=Array.from({length:64},()=>Array(64).fill(0n));for(let n=0;n<64;n++){const e=n%8,t=Math.floor(n/8);for(const{df:o,dr:s}of Bt){let c=e+o,r=t+s,l=0n;for(;c>=0&&c<8&&r>=0&&r<8;){const i=r*8+c;te[n][i]=l,l|=1n<<BigInt(i),c+=o,r+=s}}}function oe(n,e,t){const o=e===_,s=u0(e,n),c=u0(o?H:_,n),r=o?H:_,l=E0(t,c)&At(n,r),i=d0(t,c)&xt(n,r);let f=0n;function a(m){let d=m;for(;d;){const u=i0(d);d&=d-1n;const g=te[t][u]&s;g!==0n&&(g&g-1n)===0n&&(f|=g)}}return a(l),a(i),f}function se(n){const e=n%8,t=Math.floor(n/8);return function(s){const c=s%8,r=Math.floor(s/8),l=c-e,i=r-t,f=l===0?0:l/Math.abs(l),a=i===0?0:i/Math.abs(i),m=f===0||a===0,d=Math.abs(l)===Math.abs(i);if(!(m||d))return 0n;let u=0n,E=e+f,g=t+a;for(;E>=0&&E<8&&g>=0&&g<8;){const B=g*8+E;u|=1n<<BigInt(B),E+=f,g+=a}return u}}const Rt=[1,7,8,9,-1,-7,-8,-9],Lt=n=>{let e=0n;for(const t of Rt){const o=n+t;Gn(o)&&Ut(n,o)&&(e|=1n<<BigInt(o))}return e},Ut=(n,e)=>{const t=n%8,o=e%8,s=Math.abs(t-o);return!(s!==1&&s!==0)},gn=(()=>{const n=new Array(64);for(let e=0;e<64;e++)n[e]=Lt(e);return n})(),Kt=(n,e,t,o,s)=>{const c=Y(n),r=u0(e,n);let l=E0(t,c);if(1n<<BigInt(t)&o){const f=s(t);l&=f}return l&~r},Wt=(n,e,t,o,s)=>{const c=Y(n),r=u0(e,n);let l=d0(t,c)|E0(t,c);if(1n<<BigInt(t)&o){const f=s(t);l&=f}return l&~r},dn=(n,e,t,o,s=null)=>{const c=u0(e,n);let r=gn[t]&~c;const l=e===_,i=Y(n);s&&(l?(s[on]&&Ee(_,o,i)&&(r|=1n<<6n),s[sn]&&me(_,o,i)&&(r|=1n<<2n)):(s[rn]&&Ee(H,o,i)&&(r|=1n<<62n),s[cn]&&me(H,o,i)&&(r|=1n<<58n)));const f=1n<<BigInt(t);if(f&o){let a=r;for(;a;){const m=i0(a),d=1n<<BigInt(m);a&=a-1n;let u=i;u&=~f,u|=d;const E=E0(m,u)&(l?n[L]|n[D]:n[R]|n[z]),g=d0(m,u)&(l?n[r0]|n[D]:n[s0]|n[z]);(E||g)&&(r&=~d)}}return r&~o},Ft=(n,e,t,o,s,c)=>{const r=1n<<BigInt(t),l=e===_,i=_t(n),f=l?P0(n):S0(n);let a=0n,m=0n,d=0n,u=0n;if(l){if(a=r<<8n&i,m=(r&0x000000000000ff00n)<<16n&i&i<<8n,d=$0[t]&f,o!==null){const E=1n<<BigInt(o);u=$0[t]&E}}else if(a=r>>8n&i,m=(r&0x00ff000000000000n)>>16n&i&i>>8n,d=j0[t]&f,o!==null){const E=1n<<BigInt(o);u=j0[t]&E}if(s&r){const E=c(t);a&=E,m&=E,d&=E,u&=E}if(u){const E=i0(n[l?W:F]),g=E%8;if((E-g)/8-Math.floor(t/8)===0){const N=o,p=l?N-8:N+8,w=1n<<BigInt(p),O=Y(n)&~w&~r,M=n[l?L:R]|n[l?D:z];(ie(O,E)&M)!==0n&&(u=0n)}}return a|m|d|u},Qt=(n,e,t,o)=>{if(1n<<BigInt(t)&o)return 0n;let c=an[t];const r=u0(e,n);return c&~r},Ht=(n,e,t,o,s)=>{const c=Y(n),r=u0(e,n);let l=d0(t,c);if(1n<<BigInt(t)&o){const f=s(t);l&=f}return l&~r},re=(n,e,t,o,s,c,r,l,i)=>{let f=null;switch(e){case j:case e0:f=Ft(n,o,t,s,l,i);break;case n0:case _0:f=Qt(n,o,t,l);break;case s0:case r0:f=Ht(n,o,t,l,i);break;case R:case L:f=Kt(n,o,t,l,i);break;case z:case D:f=Wt(n,o,t,l,i);break;case W:case F:f=dn(n,o,t,r,c);break;default:f=BigInt(0)}return f},g0=(n,e,t,o)=>{let s=[];const c=e===_,l=R0(c?H:_),f=Q[c?W:F][0],a=oe(n,e,f),m=se(f);let d=~0n;if(l&1n<<BigInt(f)){const E=ne(n,e,f),g=zn(E);if(g>1){const v=dn(n,e,f,l,t);return bn(v,f,c?W:F,o,e)}if(g!==1)throw new Error("KING IN CHECK W/O CHECKERS");const B=i0(E);I[B]%6===n0?d=E:d=ee(f,B)|E}const u=qn(e);for(const E of u){const g=I[E],B=re(n,g,E,e,o,t,l,a,m),v=O0(g)?B:B&d,N=bn(v,E,g,o,e);s=s.concat(N)}return s},ce=(n,e)=>(e&1n<<BigInt(n))!==0n,N0=(n,e)=>{let t=W,o=H;e===H&&(t=F,o=_);const s=Q[t][0],c=R0(o);return ce(s,c)},Vt=(n,e,t,o)=>{const s=e===_,c=s?H:_,r=R0(c),l=s?W:F,i=Q[l][0];i===void 0&&(console.log(Q[l],l),console.log(Jn(n,e,t,o)));const f=1n<<BigInt(i);if((f&r)===0n&&(gn[i]&~r&~Y(n))!==0n)return!0;const a=oe(n,e,i),m=se(i);let d=~0n;if(r&f){const E=ne(n,e,i),g=zn(E);if(g>1)return dn(n,e,i,r,t)!==0n;if(g!==1)throw console.log(Jn(n,e,t,o)),console.log(Yn(r)),m0(n),console.log(Yn(R0(c))),new Error("KING IN CHECK W/O CHECKERS");const B=i0(E);I[B]%6===n0?d=E:d=ee(i,B)|E}const u=qn(e);for(const E of u){const g=I[E],B=re(n,g,E,e,o,t,r,a,m);if((O0(g)?B:B&d)!==0n)return!0}return!1},l0=n=>{const e=n.piece;let t=null;if((e===j||e===e0)&&Math.abs(n.to-n.from)===16){const o=e===j?-8:8;t=n.to+o}return t};function J(n,e,t,o){let s=0n,c=n;for(;c=(c&t)<<e,!(!c||c===0n);){if(c&o){s|=c;break}s|=c}return s}const Gt=(n,e,t,o=!1,s=null)=>{let c="";const r=t%8,l=tn[r],i=(t-r)/8,f=I[t],a=dt[f],m=f>5?_:H;if(a==="P"||s){if(o){const d=e%8;c+=tn[d]+"x"}c+=l+(i+1)}else a==="K"&&Math.abs(e-t)===2?e-t===2?c="O-O-O":c="O-O":(c+=a,o&&(c+="x"),c+=l+(i+1));if(s&&(c+="="+a),N0(n,m)){if(g0(n,m,null,null).length===0)return c+="#",c;c+="+"}return c};function $t(n,e){let t=1n<<BigInt(e),o=0n;return o|=J(t,9n,F0&H0,n),o|=J(t,7n,Q0&H0,n),o|=J(t,-7n,F0&V0,n),o|=J(t,-9n,Q0&V0,n),o}function ie(n,e){let t=1n<<BigInt(e),o=0n;return o|=J(t,1n,F0,n),o|=J(t,-1n,Q0,n),o|=J(t,8n,H0,n),o|=J(t,-8n,V0,n),o}const le=Array.from({length:64},(n,e)=>jt(e)),fe=Array.from({length:64},(n,e)=>zt(e));function ue(n,e){return e*8+n}function jt(n){const e=n%8,t=Math.floor(n/8);let o=0n;const s=[[0,1],[0,-1],[1,0],[-1,0]];for(const[c,r]of s){let l=e+c,i=t+r;for(;l>=0&&l<8&&i>=0&&i<8;){const f=l+c,a=i+r;if(f>=8||f<0||a>=8||a<0)break;o|=1n<<BigInt(ue(l,i)),l+=c,i+=r}}return o}function zt(n){const e=n%8,t=Math.floor(n/8);let o=0n;const s=[[1,1],[-1,1],[1,-1],[-1,-1]];for(const[c,r]of s){let l=e+c,i=t+r;for(;l>0&&l<7&&i>0&&i<7;)o|=1n<<BigInt(ue(l,i)),l+=c,i+=r}return o}const En=[58,59,59,59,59,59,59,58,59,59,59,59,59,59,59,59,59,59,57,57,57,57,59,59,59,59,57,55,55,57,59,59,59,59,57,55,55,57,59,59,59,59,57,57,57,57,59,59,59,59,59,59,59,59,59,59,58,59,59,59,59,59,59,58],ae=[0x1084200882008102n,0x818102100410000n,0x4064440182010000n,0x8108048110040402n,0x3604102800000108n,0x105042024040010n,0x4140c04260010n,0x8000208a080b4000n,0x40420288120084n,0x200900123040080n,0x8020140104030440n,0x260040400802108n,0x1c2040422000104n,0xa2020510081000n,0x1200084100a1002n,0x20008a20822008n,0x400c001120080102n,0x1020043032008100n,0x2a1002802002201n,0xc001008801490000n,0x2401008811400000n,0x2100800040602002n,0x302000043042002n,0x40820202012111n,0x1402180040084804n,0x228021044240800n,0x208088081040100n,0x528822008020020n,0x111200a0020080c0n,0x2808020480404600n,0x88010044440a00n,0x2002044002840380n,0x402108090020a000n,0x408011008040c41n,0x2021205010800n,0x404018a0120200n,0x40054010030101n,0x4008902100208084n,0x1008408100040905n,0x42004108014420n,0x8250c10022000n,0x2a084104001800n,0x30400a2002414n,0x200041a44000804n,0x4122000e0800c00n,0x1002201045008080n,0x30016801108080n,0x8402040400208080n,0x2801828808410000n,0x81010190040021n,0x300120203044000n,0x406020484240004n,0x4500001006020042n,0x400142428820010n,0x2440050800810004n,0x1842040c003000n,0x8420210090410n,0x200008841082000n,0x4c01000046080401n,0x11008000810c8801n,0x18003400a0042400n,0x20019020114100n,0x100402903010204n,0x4040190401020020n],mn=[52,53,53,53,53,53,52,52,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,53,54,54,54,54,54,54,53,52,53,53,53,53,53,53,52],ge=[0x8080008414400221n,0x504000100c200041n,0x1100200010484101n,0x2300200900100004n,0x1000a3500100800n,0x8200030810060004n,0xa00241800a20001n,0x2200009200410024n,0x2820800070844000n,0x38400320005000n,0x200260012c280n,0x2016801000480084n,0x4001000c11010801n,0xa0008c2001004n,0x14000110421804n,0x2025800049000080n,0x440008000482388n,0x801008c004422001n,0x9420008010002480n,0x802a0042002010n,0x401010004880230n,0xc02808004010600n,0xd40042019008n,0x8044220001008044n,0x804080010020c308n,0x8040600280400085n,0xd800200100104102n,0x4007002100100108n,0x1015050100080030n,0x1008540080420080n,0x4000110400221098n,0x818004600008304n,0x440002046800282n,0x100834000802001n,0x1060200501003040n,0x429809000800800n,0x240080c401800800n,0x4002011092000428n,0x400c031004002802n,0x114092000104n,0x8200c00480288004n,0x2810024220064000n,0x39002000110041n,0x3410100100090020n,0x400480091010014n,0x1402001008420064n,0x90a02a0001008080n,0x100400c0820005n,0x8041088040620200n,0x620020d1008200n,0xe60009000208080n,0x80b0018008001080n,0x340808801040080n,0x4409000884000300n,0x18201001c8020400n,0x0000800041000080n,0x2000110040660082n,0x4000210040098011n,0x82000104100a00dn,0x1002084500029n,0x201000c50020801n,0x82001004012822n,0x8008084090210204n,0x102044810406n],kn=Array(64),pn=Array(64);function*de(n){for(let e=n;yield e,e!==0n;e=e-1n&n);}for(let n=0;n<64;n++){const e=le[n],t=fe[n],o=1<<64-mn[n],s=1<<64-En[n];kn[n]=new Array(o),pn[n]=new Array(s);for(const c of de(e)){const r=c&e,i=BigInt.asUintN(64,r*BigInt(ge[n]))>>BigInt(mn[n]),f=Number(i),a=ie(c,n);kn[n][f]=a}for(const c of de(t)){const r=Number(BigInt.asUintN(64,(c&t)*BigInt(ae[n]))>>BigInt(En[n])),l=$t(c,n);pn[n][r]=l}}function d0(n,e){const t=e&fe[n],o=Number(BigInt.asUintN(64,t*ae[n])>>BigInt(En[n]));return pn[n][o]}function E0(n,e){const t=e&le[n],o=Number(BigInt.asUintN(64,t*ge[n])>>BigInt(mn[n]));return kn[n][o]}function Dt(n,e,t){switch(e){case j:return $0[t];case e0:return j0[t];case n0:case _0:return an[t];case W:case F:return gn[t];case s0:case r0:return d0(t,n);case R:case L:return E0(t,n);case z:case D:return d0(t,n)|E0(t,n);default:return 0n}}function x0(n,e){let t=0n;const o=Q[n];for(const s of o)t|=Dt(e,n,s);return t}function m0(n){const e=Y(n);for(let t=0;t<Z;t++)b[t]=x0(t,e);return b}const b=new BigUint64Array(Z).fill(0n);m0(U);const z0=(n,e)=>{const t=e.piece,o=e.captured,s=e.promotion,c=Y(n);jn(t)||(b[t]=x0(t,c)),o!==null&&!jn(o)&&(b[o]=x0(o,c)),(s===n0||s===_0)&&(b[s]=x0(s,c));const r=[s0,R,z,r0,L,D],l=qt(e);for(const i of r)Xt(i,e,c,l)};function Xt(n,e,t,o){if(e.captured===n||e.piece===n||e.promotion===n){b[n]=x0(n,t);return}(b[n]&o)!==0n&&(b[n]=x0(n,t))}function qt(n){let e=0n;if(e|=1n<<BigInt(n.from),e|=1n<<BigInt(n.to),n.enPassant){const t=n.piece<6?-8:8,o=n.to+t;e|=1n<<BigInt(o)}return e}const R0=n=>{let e=0n;if(n===_)for(let t=0;t<6;t++)e|=b[t];else for(let t=6;t<=11;t++)e|=b[t];return e},k0=(n,e,t)=>{const o=[...t];return n===4?(o[on]=!1,o[sn]=!1):n===60?(o[rn]=!1,o[cn]=!1):n===0||e===0?o[sn]=!1:n===7||e===7?o[on]=!1:n===56||e===56?o[cn]=!1:(n===63||e===63)&&(o[rn]=!1),o},Ee=(n,e,t)=>{let o;n===_?o=[4,5,6]:o=[60,61,62];for(const s of o){const c=1n<<BigInt(s);if(e&c||c&t&&(n===_?s!==4:s!==60))return!1}return!0},me=(n,e,t)=>{let o;n===_?o=[1,2,3,4]:o=[57,58,59,60];for(const s of o){const c=1n<<BigInt(s);if(e&c&&s!==1&&s!==57||c&t&&(n===_?s!==4:s!==60))return!1}return!0},Yt=(n,e)=>{const t=e.from,o=e.to;Y(n),t===4&&o===6?(n[W]&=~(1n<<4n),n[W]|=1n<<6n,n[R]&=~(1n<<7n),n[R]|=1n<<5n,I[o]=W,I[t]=null,I[7]=null,I[5]=R):t===4&&o===2?(n[W]&=~(1n<<4n),n[W]|=1n<<2n,n[R]&=~(1n<<0n),n[R]|=1n<<3n,I[o]=W,I[t]=null,I[0]=null,I[3]=R):t===60&&o===62?(n[F]&=~(1n<<60n),n[F]|=1n<<62n,n[L]&=~(1n<<63n),n[L]|=1n<<61n,I[o]=F,I[t]=null,I[63]=null,I[61]=L):t===60&&o===58&&(n[F]&=~(1n<<60n),n[F]|=1n<<58n,n[L]&=~(1n<<56n),n[L]|=1n<<59n,I[o]=F,I[t]=null,I[56]=null,I[59]=L),Dn(e),z0(n,e)},Jt=(n,e)=>{const t=e.from,o=e.to;Y(n),t===4&&o===6?(n[W]&=~(1n<<6n),n[W]|=1n<<4n,n[R]&=~(1n<<5n),n[R]|=1n<<7n,I[t]=W,I[o]=null,I[5]=null,I[7]=R):t===4&&o===2?(n[W]&=~(1n<<2n),n[W]|=1n<<4n,n[R]&=~(1n<<3n),n[R]|=1n<<0n,I[t]=W,I[o]=null,I[3]=null,I[0]=R):t===60&&o===62?(n[F]&=~(1n<<62n),n[F]|=1n<<60n,n[L]&=~(1n<<61n),n[L]|=1n<<63n,I[t]=F,I[o]=null,I[61]=null,I[63]=L):t===60&&o===58&&(n[F]&=~(1n<<58n),n[F]|=1n<<60n,n[L]&=~(1n<<59n),n[L]|=1n<<56n,I[t]=F,I[o]=null,I[59]=null,I[56]=L),Xn(e),z0(n,e)},Bn=Object.freeze({HISTORY:"history",BATTLE:"battle",NEW:"new",NONE:null}),X=Object.freeze({BMV1:"BMV1",BMV2:"BMV2",BMV3:"BMV3",BMV4:"BMV4",BMV5:"BMV5"});X.BMV1,X.BMV2,X.BMV3,X.BMV4,X.BMV5;const ke=()=>({bitboards:U.slice(),pastBitboards:[],pastMoves:[],pastPositions:new Map,currPlayer:_,boardViewSide:_,enPassantSquare:null,castlingRights:[!0,!0,!0,!0],fiftyMoveRuleCounter:0,promotion:!1,promotionMove:null,isGameOver:!1,result:null,gameHistory:[],userSide:_,selectedEngine:X.BMV5,engineDepth:4,engineTimeLimitMs:5e3,displayedBitboards:U.slice(),selectedSquare:null,moveBitboard:null,isCurrPositionShown:!0,currIndexOfDisplayed:-1,isModalOpen:!1,modalType:Bn.NONE,breakBattleLoop:!1}),p0=at((n,e)=>{un(U),m0(U),fn(U);const t=ke();return n(t),{...t,updateStates:(o,s,c)=>{n(r=>{let l=r.fiftyMoveRuleCounter+1;const i=s.piece;return(s.captured!==null||i===j||i===e0)&&(l=0),{isGameOver:c.isGameOver,result:c.result,pastMoves:[...r.pastMoves,o],enPassantSquare:l0(s),castlingRights:k0(s.from,s.to,r.castlingRights),selectedSquare:null,moveBitboard:null,pastPositions:r.pastPositions,pastBitboards:[...r.pastBitboards,r.bitboards.slice()],displayedBitboards:r.bitboards.slice(),currIndexOfDisplayed:r.currIndexOfDisplayed+1,currPlayer:r.currPlayer===_?H:_,fiftyMoveRuleCounter:l,promotion:!1,promotionMove:null}})},resetGame:({isEngineGame:o=!1,userSide:s=null,engine:c=X.BMV5,depth:r=4,timeLimitMs:l=5e3})=>{const i=e(),f=i.isGameOver?{moves:i.pastMoves,bitboards:i.pastBitboards,result:i.result,isEngineGame:o,userSide:i.userSide}:null;if(!Object.values(X).includes(c)){console.warn("Invalid engine passed");return}un(U),m0(U),fn(U),n(()=>({...ke(),gameHistory:f?[...i.gameHistory,f]:i.gameHistory,userSide:s,selectedEngine:c,engineDepth:r,engineTimeLimitMs:l,boardViewSide:s}))},updateShownGame:o=>{const s=o.bitboards[o.bitboards.length-1];n(()=>({pastMoves:o.moves,pastBitboards:o.bitboards,bitboards:s,result:o.result,displayedBitboards:s,isCurrPositionShown:!1,currIndexOfDisplayed:o.bitboards.length-1}))},goToMove:(o,s)=>{n(c=>{let r=o*2+s;const l=r===c.pastBitboards.length-1;return{displayedBitboards:l?c.bitboards.slice():c.pastBitboards[r],isCurrPositionShown:l,currIndexOfDisplayed:r}})},openModal(o){if(!Object.values(Bn).includes(o)){console.warn(`Invalid modal type: ${o}`);return}n(()=>({isModalOpen:!0,modalType:o}))},closeModal:()=>{n(()=>({isModalOpen:!1,modalType:Bn.NONE}))},flipBoardView:()=>{n(o=>({boardViewSide:o.boardViewSide===_?H:_}))},changeViewedMove:o=>{const s=e(),c=s.currIndexOfDisplayed+o;c<0||c>=s.pastBitboards.length||(n(r=>({displayedBitboards:r.pastBitboards[c],currIndexOfDisplayed:r.currIndexOfDisplayed+o})),c===s.pastBitboards.length-1?n(()=>({isCurrPositionShown:!0})):n(()=>({isCurrPositionShown:!1,selectedSquare:null,moveBitboard:null})))}}}),B0=(n,e,t,o,s)=>{const c=e===_,r=c?H:_,l=R0(e),i={isGameOver:!1,result:null};if(Zt(n))return i.isGameOver=!0,i.result="Draw by Insufficient Material",i;if(no(s))return i.isGameOver=!0,i.result="Draw By 50 Move Rule",i;if(bt(t))return i.isGameOver=!0,i.result="Draw by Repetition",i;if(!Vt(n,r,null,o)){i.isGameOver=!0;const a=Q[c?F:W][0];if(ce(a,l)){const m=c?"White":"Black";return i.result=`${m} Wins by Checkmate`,i}return i.result="Draw by Stalemate",i}return i},Zt=n=>{const e=S0(n),t=P0(n),o=n[z]|n[D],s=n[R]|n[L],c=n[j]|n[e0];return(o|s|c)!==0n?!1:$n(e)<=2&&$n(t)<=2},bt=n=>{for(let e of n.values())if(e>=3)return!0;return!1},no=n=>n>=100;function M0(){const n=Math.floor(Math.random()*4294967296),e=Math.floor(Math.random()*4294967296);return BigInt(n)<<32n|BigInt(e)}const t0=new BigUint64Array(Z*64);for(let n=0;n<Z;n++)for(let e=0;e<64;e++)t0[n*64+e]=M0();const Mn=Array(8).fill(null).map(()=>M0()),eo=[M0(),M0(),M0(),M0()],pe=M0(),L0=(n,e,t=null,o=null)=>{let s=0n;const c=T0();for(const r of c){const l=I[r];s^=t0[l*64+r]}if(e===H&&(s^=pe),t>=0&&(s^=Mn[t]),o)for(let r=0;r<o.length;r++)o[r]&&(s^=eo[r]);return s},w0=(n,e,t,o,s)=>{let c=n;const r=e.from,l=e.to,i=e.captured,f=t0[e.piece*64+r];c^=f;const a=e.promotion?e.promotion:e.piece,m=t0[a*64+l];if(c^=m,i!==null){const d=t0[i*64+l];c^=d}if(c^=pe,t!==o&&(t>=0&&(c^=Mn[t]),o>=0&&(c^=Mn[o])),e.castling){const d=r===4,u=d?R:L;if(r>l){const E=d?0:56;c^=t0[u*64+E];const g=E+3;c^=t0[u*64+g]}else{const E=d?7:63;c^=t0[u*64+E];const g=E-2;c^=t0[u*64+g]}}for(let d=0;d<s.length;d++)s[d]&&(c^=mt[d]);return c},to=async()=>{const n=await vt();for(const e of n){const t=Zn(e.slice(0,2)),o=Zn(e.slice(2,4));Me(t,o,null)}},Be=(n,e=3,t=1/0)=>{const{isCurrPositionShown:o,isGameOver:s,bitboards:c,currPlayer:r,castlingRights:l,enPassantSquare:i,pastPositions:f}=p0.getState();if(!o||s)return;const a=n(c,r,l,i,f,e,t),m=a.from,d=a.to,u=a.promotion;Me(m,d,u)},Me=(n,e,t=null)=>{const{bitboards:o,currPlayer:s,castlingRights:c,enPassantSquare:r,pastPositions:l,updateStates:i,fiftyMoveRuleCounter:f}=p0.getState(),a=I[n],m=O0(a)&&Math.abs(n-e)===2,d=e===r&&(a===WHITE_PAWN||a===BLACK_PAWN);let u=I[e];d&&(u=a===WHITE_PAWN?BLACK_PAWN:WHITE_PAWN);const E=new G0(n,e,a,u,t,m,d);a0(o,E);const g=l0(E),B=g?g%8:-1,v=L0(o,s,B,c);l.set(v,(l.get(v)||0)+1);const N=B0(o,s,l,g,f),p=Gt(o,n,e,E.captured!==null);i(p,E,N)};class Ie{constructor(e){this.cache=new Map,this.maxSize=e}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}set(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxSize){const o=this.cache.keys().next().value;this.cache.delete(o)}this.cache.set(e,t)}has(e){return this.cache.has(e)}delete(e){return this.cache.delete(e)}clear(){this.cache.clear()}getSize(){return this.cache.size}}const _e=1<<20,In=new Ie(_e),P={EXACT:0,LOWER_BOUND:1,UPPER_BOUND:2},D0=()=>{In.clear()},_n=n=>In.get(n),hn=(n,e)=>{In.set(n,e)},An=new Ie(_e),he=()=>{An.clear()},Ae=n=>An.get(n),xe=(n,e)=>{An.set(n,e)},we=(n,e,t)=>{if(e)return e.includes("Checkmate")?-c0+t:0;let o=0;const s=T0();for(const c of s){const r=I[c];o+=h0[r]}return n===_?o:-o},ve=(n,e,t,o,s,c,r,l,i,f)=>{const a=e===_?H:_,m=B0(n,a,s,o,0);if(m.isGameOver)return{score:we(a,m.result,r),move:null};if(r>=l&&(!N0(n,e)||r!==l))return{score:we(e,m.result,r),move:null};const d=g0(n,e,t,o).map(B=>{let v=0;return B.captured&&(v+=(h0[B.captured%6]||0)-(h0[B.piece%6]||0)),{move:B,score:v}});if(d.length===0)throw new Error("Issue with move generation. No moves generated");d.sort((B,v)=>v.score-B.score);const u=d.map(B=>B.move);let E=-1/0,g=null;for(const B of u){a0(n,B);const v=B.from,N=l0(B),p=k0(v,B.to,t),w=new Map(s),O=N?N%8:-1,M=o?o%8:-1,k=new Array(p.length);for(let S=0;S<p.length;S++)t[S]!==p[S]?k[S]=!0:k[S]=!1;const h=w0(c,B,O,M,k);w.set(h,(w.get(h)||0)+1);const{score:y}=ve(n,a,p,N,w,h,r+1,l,-f,-i);A0(B,n);const A=-y;if(A>E&&(E=y,g=B),A>i&&(i=A),f<=i)break}return{score:E,move:g}};function oo(n,e,t,o,s,c,r=1/0){D0();const l=performance.now();let i=null,f=null;const a=o?o%8:-1,m=L0(n,e,a,t);for(let d=1;d<=c;d++){m0(n);const{score:u,move:E}=ve(n,e,t,o,s,m,0,d,-1/0,1/0);if(E!=null&&(i=E,f=u),Math.abs(u)>c0-d&&E)break;if(performance.now()-l>r){console.log("time limit");break}}return{...i,bestEval:f}}const ye=(n,e,t)=>{if(e)return e.includes("Checkmate")?-c0+t:0;let o=0;const s=T0();for(const c of s){const r=I[c];o+=h0[r]}return n===_?o:-o},Ce=Array.from({length:ln},()=>[null,null]),Oe=Array.from({length:64},()=>Array(64).fill(0)),Se=(n,e,t,o,s,c,r,l,i,f)=>{const a=e===_?H:_,m=B0(n,a,s,o,0);if(m.isGameOver)return{score:ye(a,m.result,r),move:null};if(r>=l&&(!N0(n,e)||r!==l))return{score:ye(e,m.result,r),move:null};const d=c,u=i,E=l-r,g=_n(d);if(g&&g.depth>=E&&g.rootId===X0){if(g.flag===P.EXACT)return{score:g.value,move:g.bestMove};if(g.flag===P.LOWER_BOUND&&(i=Math.max(i,g.value)),g.flag===P.UPPER_BOUND&&(f=Math.min(f,g.value)),i>=f)return{score:g.value,move:g.bestMove}}const B=(g==null?void 0:g.bestMove)||null,v=g0(n,e,t,o).map(M=>{let k=0;const h=M.from,y=M.to;B&&h===B.from&&y===B.to&&(k+=1e6),M.captured&&(k+=1e5+(h0[M.captured%6]||0)-(h0[M.piece%6]||0));const[A,S]=Ce[r];return A&&h===A.from&&y===A.to?k+=9e4:S&&h===S.from&&y===S.to&&(k+=8e4),k+=Oe[h][y],{move:M,score:k}});if(v.length===0)throw new Error("Issue with move generation. No moves generated");v.sort((M,k)=>k.score-M.score);const N=v.map(M=>M.move);let p=-1/0,w=null;for(const M of N){a0(n,M);const k=M.from,h=l0(M),y=k0(k,M.to,t),A=new Map(s),S=h?h%8:-1,G=o?o%8:-1,V=new Array(y.length);for(let K=0;K<y.length;K++)t[K]!==y[K]?V[K]=!0:V[K]=!1;const x=w0(c,M,S,G,V);A.set(x,(A.get(x)||0)+1);const{score:o0}=Se(n,a,y,h,A,x,r+1,l,-f,-i);A0(M,n);const f0=-o0;if(f0>p&&(p=f0,w=M),f0>i&&(i=f0),f<=i){if(M.captured===null){const K=Ce[r];(!K[0]||M.from!==K[0].from||M.to!==K[0].to)&&(K[1]=K[0],K[0]=M),Oe[M.from][M.to]+=2^l-r}break}}let O=P.EXACT;return p<=u?O=P.UPPER_BOUND:p>=f&&(O=P.LOWER_BOUND),hn(d,{rootId:X0,depth:l-r,value:p,flag:O,bestMove:w}),{score:p,move:w}};let X0=0;function so(n,e,t,o,s,c,r=1/0){D0();const l=performance.now();let i=null,f=null;const a=o?o%8:-1,m=L0(n,e,a,t);X0=0;for(let d=1;d<=c;d++){m0(n);const{score:u,move:E}=Se(n,e,t,o,s,m,0,d,-1/0,1/0);if(E!=null&&(f=u,i=E),Math.abs(u)>c0-d&&E)break;if(performance.now()-l>r){console.log("time limit");break}X0++}return{...i,bestEval:f}}const xn=(n,e,t)=>{if(e)return e.includes("Checkmate")?-c0+t:0;let o=0;const s=T0();for(const c of s){const r=I[c],l=r<6?1:-1;o+=l*v0[r%6]}return n===_?o:-o},v0=[100,320,330,500,900,2e4],Pe=(n,e,t)=>g0(n,e,null,t).filter(s=>s.captured!==null||s.promotion),wn=6,Te=Array.from({length:wn},()=>[null,null]),Ne=Array.from({length:64},()=>Array(64).fill(0)),Re=(n,e,t,o,s,c,r,l,i=0)=>{const f=e===_?H:_,a=B0(n,f,r,s,0);if(a.isGameOver)return{score:xn(f,a.result,0),move:null};const m=xn(e,null,0);if(i+1>wn)return{score:m,move:null};if(m>=o)return{score:o,move:null};const d=t;t=Math.max(t,m);const u=Ae(l),E=wn-i;if(u&&u.depth>=E&&u.isQuiescence){if(u.flag===P.EXACT)return{score:u.value,move:null};if(u.flag===P.LOWER_BOUND&&u.value>t?t=u.value:u.flag===P.UPPER_BOUND&&u.value<o&&(o=u.value),t>=o)return{score:u.value,move:null}}const g=(u==null?void 0:u.bestMove)||null,B=Pe(n,e,s).map(p=>{let w=0;const O=p.from,M=p.to;g&&O===g.from&&M===g.to&&(w+=1e6),p.captured&&(w+=1e5+(v0[p.captured%6]||0)-(v0[p.piece%6]||0));const[k,h]=Te[i];return k&&O===k.from&&M===k.to?w+=9e4:h&&O===h.from&&M===h.to&&(w+=8e4),w+=Ne[O][M],{move:p,score:w}});B.sort((p,w)=>w.score-p.score);const v=B.map(p=>p.move);for(const p of v){const w=v0[p.captured%6]||0;if(m+w<=t)continue;a0(n,p);const O=l0(p),M=k0(p.from,p.to,c),k=O?O%8:-1,h=s?s%8:-1,y=new Array(M.length);for(let x=0;x<M.length;x++)c[x]!==M[x]?y[x]=!0:y[x]=!1;const A=w0(l,p,k,h,y),S=r.get(A)||0;r.set(A,S+1);const{score:G}=Re(n,f,-o,-t,O,M,r,A,i+1);A0(p,n),S?r.set(A,S):r.delete(A);const V=-G;if(V>=o)return{score:o,move:null};if(V>t&&(t=V),o<=t){if(p.captured===null){const x=Te[i];(!x[0]||p.from!==x[0].from||p.to!==x[0].to)&&(x[1]=x[0],x[0]=p),Ne[p.from][p.to]+=2^E}break}}let N=P.EXACT;return t<=d?N=P.UPPER_BOUND:t>=o&&(N=P.LOWER_BOUND),xe(l,{value:t,depth:E,flag:N,isQuiescence:!0}),{score:t,move:null}},Le=Array.from({length:ln},()=>[null,null]),Ue=Array.from({length:64},()=>Array(64).fill(0)),Ke=(n,e,t,o,s,c,r,l,i,f)=>{const a=e===_?H:_,m=B0(n,a,s,o,0);if(m.isGameOver)return{score:xn(a,m.result,r),move:null};if(r>=l&&(!N0(n,e)||r!==l))return{score:Re(n,e,i,f,o,t,s,c).score,move:null};const d=c,u=i,E=l-r,g=_n(d);if(g&&g.depth>=E&&g.rootId===q0){if(g.flag===P.EXACT)return{score:g.value,move:g.bestMove};if(g.flag===P.LOWER_BOUND&&(i=Math.max(i,g.value)),g.flag===P.UPPER_BOUND&&(f=Math.min(f,g.value)),i>=f)return{score:g.value,move:g.bestMove}}const B=(g==null?void 0:g.bestMove)||null,v=g0(n,e,t,o).map(k=>{let h=0;const y=k.from,A=k.to;B&&y===B.from&&A===B.to&&(h+=1e6),k.captured&&(h+=1e5+(v0[k.captured%6]||0)-(v0[k.piece%6]||0));const[S,G]=Le[r];return S&&y===S.from&&A===S.to?h+=9e4:G&&y===G.from&&A===G.to&&(h+=8e4),h+=Ue[y][A],{move:k,score:h}});if(v.length===0)throw new Error("Issue with move generation. No moves generated");v.sort((k,h)=>h.score-k.score);const N=v.map(k=>k.move);let p=-1/0,w=null;for(const k of N){a0(n,k);const h=k.from,y=l0(k),A=k0(h,k.to,t),S=y?y%8:-1,G=o?o%8:-1,V=new Array(A.length);for(let T=0;T<A.length;T++)t[T]!==A[T]?V[T]=!0:V[T]=!1;const x=w0(c,k,S,G,V),o0=s.get(x)||0;s.set(x,o0+1);const{score:f0}=Ke(n,a,A,y,s,x,r+1,l,-f,-i);A0(k,n),o0?s.set(x,o0):s.delete(x);const K=-f0;if(K>p&&(p=K,w=k),K>i&&(i=K),f<=i){if(k.captured===null){const T=Le[r];(!T[0]||k.from!==T[0].from||k.to!==T[0].to)&&(T[1]=T[0],T[0]=k),Ue[k.from][k.to]+=2^l-r}break}}let O=P.EXACT;const M=p;return M<=u?O=P.UPPER_BOUND:M>=f&&(O=P.LOWER_BOUND),hn(d,{rootId:q0,depth:l-r,value:M,flag:O,bestMove:w}),{score:p,move:w}};let q0=0;function ro(n,e,t,o,s,c,r=1/0){D0(),he();const l=performance.now();let i=null,f=null;const a=o?o%8:-1,m=L0(n,e,a,t);q0=0;for(let d=1;d<=c;d++){m0(n);const{score:u,move:E}=Ke(n,e,t,o,s,m,0,d,-1/0,1/0);if(E!==null&&(f=u,i=E),Math.abs(u)>c0-d&&E||performance.now()-l>r)break;q0++}return{...i,bestEval:f}}const co=[[0,0,0,0,0,0,0,0,5,10,10,-20,-20,10,10,5,5,-5,-10,0,0,-10,-5,5,0,0,10,20,20,0,0,0,5,5,10,25,25,10,5,5,10,10,20,30,30,20,10,10,50,50,50,50,50,50,50,50,0,0,0,0,0,0,0,0],[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,5,5,0,-20,-40,-30,5,20,15,15,20,5,-30,-30,0,15,25,25,15,0,-30,-30,5,15,25,25,15,5,-30,-30,0,10,15,15,10,0,-30,-40,-20,0,0,0,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],[-20,-10,-10,-10,-10,-10,-10,-20,-10,5,0,0,0,0,5,-10,-10,10,10,10,10,10,10,-10,-10,0,10,10,10,10,0,-10,-10,5,5,10,10,5,5,-10,-10,0,5,10,10,5,0,-10,-10,0,0,0,0,0,0,-10,-20,-10,-10,-10,-10,-10,-10,-20],[0,0,5,10,10,5,0,0,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,5,10,10,10,10,10,10,5,0,0,0,0,0,0,0,0],[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,5,0,-10,-10,0,5,5,5,5,5,-10,-5,0,5,5,5,5,0,0,-5,0,5,5,5,5,0,-5,-10,0,5,5,5,5,0,-10,-10,0,0,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],[20,30,10,0,0,10,30,20,20,20,0,0,0,0,20,20,-10,-20,-20,-20,-20,-20,-20,-10,-20,-30,-30,-40,-40,-30,-30,-20,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30],[0,0,0,0,0,0,0,0,50,50,50,50,50,50,50,50,10,10,20,30,30,20,10,10,5,5,10,25,25,10,5,5,0,0,10,20,20,0,0,0,5,-5,-10,0,0,-10,-5,5,5,10,10,-20,-20,10,10,5,0,0,0,0,0,0,0,0],[-50,-40,-30,-30,-30,-30,-40,-50,-40,-20,0,0,0,0,-20,-40,-30,0,10,15,15,10,0,-30,-30,5,15,25,25,15,5,-30,-30,0,15,25,25,15,0,-30,-30,5,20,15,15,20,5,-30,-40,-20,0,5,5,0,-20,-40,-50,-40,-30,-30,-30,-30,-40,-50],[-20,-10,-10,-10,-10,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,10,10,5,0,-10,-10,5,5,10,10,5,5,-10,-10,0,10,10,10,10,0,-10,-10,10,10,10,10,10,10,-10,-10,5,0,0,0,0,5,-10,-20,-10,-10,-10,-10,-10,-10,-20],[0,0,0,0,0,0,0,0,5,10,10,10,10,10,10,5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,-5,0,0,0,0,0,0,-5,0,0,0,5,5,0,0,0],[-20,-10,-10,-5,-5,-10,-10,-20,-10,0,0,0,0,0,0,-10,-10,0,5,5,5,5,0,-10,-5,0,5,5,5,5,0,-5,0,0,5,5,5,5,0,-5,-10,5,5,5,5,5,0,-10,-10,0,5,0,0,0,0,-10,-20,-10,-10,-5,-5,-10,-10,-20],[-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-30,-40,-40,-50,-50,-40,-40,-30,-20,-30,-30,-40,-40,-30,-30,-20,-10,-20,-20,-20,-20,-20,-20,-10,20,20,0,0,0,0,20,20,20,30,10,0,0,10,30,20]],vn=(n,e,t)=>{if(e)return e.includes("Checkmate")?-c0+t:0;let o=0;const s=T0();for(const c of s){const r=I[c],l=r<6?1:-1;o+=l*(y0[r%6]+co[r][c])}return n===_?o:-o},y0=[100,320,330,500,900,2e4],yn=10,We=Array.from({length:yn},()=>[null,null]),Fe=Array.from({length:64},()=>Array(64).fill(0)),Qe=(n,e,t,o,s,c,r,l,i=0)=>{const f=e===_?H:_,a=B0(n,f,r,s,0);if(a.isGameOver)return{score:vn(f,a.result,0),move:null};const m=vn(e,null,0);if(i+1>yn)return{score:m,move:null};if(m>=o)return{score:o,move:null};const d=t;t=Math.max(t,m);const u=Ae(l),E=yn-i;if(u&&u.depth>=E&&u.isQuiescence){if(u.flag===P.EXACT)return{score:u.value,move:null};if(u.flag===P.LOWER_BOUND&&u.value>t?t=u.value:u.flag===P.UPPER_BOUND&&u.value<o&&(o=u.value),t>=o)return{score:u.value,move:null}}const g=(u==null?void 0:u.bestMove)||null,B=Pe(n,e,s).map(p=>{let w=0;const O=p.from,M=p.to;g&&O===g.from&&M===g.to&&(w+=1e6),p.captured&&(w+=1e5+(y0[p.captured%6]||0)-(y0[p.piece%6]||0));const[k,h]=We[i];return k&&O===k.from&&M===k.to?w+=9e4:h&&O===h.from&&M===h.to&&(w+=8e4),w+=Fe[O][M],{move:p,score:w}});B.sort((p,w)=>w.score-p.score);const v=B.map(p=>p.move);for(const p of v){const w=y0[p.captured%6]||0;if(m+w<=t)continue;a0(n,p);const O=l0(p),M=k0(p.from,p.to,c),k=O?O%8:-1,h=s?s%8:-1,y=new Array(M.length);for(let x=0;x<M.length;x++)c[x]!==M[x]?y[x]=!0:y[x]=!1;const A=w0(l,p,k,h,y),S=r.get(A)||0;r.set(A,S+1);const{score:G}=Qe(n,f,-o,-t,O,M,r,A,i+1);A0(p,n),S?r.set(A,S):r.delete(A);const V=-G;if(V>=o)return{score:o,move:null};if(V>t&&(t=V),o<=t){if(p.captured===null){const x=We[i];(!x[0]||p.from!==x[0].from||p.to!==x[0].to)&&(x[1]=x[0],x[0]=p),Fe[p.from][p.to]+=2^E}break}}let N=P.EXACT;return t<=d?N=P.UPPER_BOUND:t>=o&&(N=P.LOWER_BOUND),xe(l,{value:t,depth:E,flag:N,isQuiescence:!0}),{score:t,move:null}},He=Array.from({length:ln},()=>[null,null]),Ve=Array.from({length:64},()=>Array(64).fill(0)),Ge=(n,e,t,o,s,c,r,l,i,f)=>{const a=e===_?H:_,m=B0(n,a,s,o,0);if(m.isGameOver)return{score:vn(a,m.result,r),move:null};if(r>=l&&(!N0(n,e)||r!==l))return{score:Qe(n,e,i,f,o,t,s,c).score,move:null};const d=c,u=i,E=l-r,g=_n(d);if(g&&g.depth>=E&&g.rootId===Y0){if(g.flag===P.EXACT)return{score:g.value,move:g.bestMove};if(g.flag===P.LOWER_BOUND&&(i=Math.max(i,g.value)),g.flag===P.UPPER_BOUND&&(f=Math.min(f,g.value)),i>=f)return{score:g.value,move:g.bestMove}}const B=(g==null?void 0:g.bestMove)||null,v=g0(n,e,t,o).map(k=>{let h=0;const y=k.from,A=k.to;B&&y===B.from&&A===B.to&&(h+=1e6),k.captured&&(h+=1e5+(y0[k.captured%6]||0)-(y0[k.piece%6]||0));const[S,G]=He[r];return S&&y===S.from&&A===S.to?h+=9e4:G&&y===G.from&&A===G.to&&(h+=8e4),h+=Ve[y][A],{move:k,score:h}});if(v.length===0)throw new Error("Issue with move generation. No moves generated");v.sort((k,h)=>h.score-k.score);const N=v.map(k=>k.move);let p=-1/0,w=null;for(const k of N){a0(n,k);const h=k.from,y=l0(k),A=k0(h,k.to,t),S=y?y%8:-1,G=o?o%8:-1,V=new Array(A.length);for(let T=0;T<A.length;T++)t[T]!==A[T]?V[T]=!0:V[T]=!1;const x=w0(c,k,S,G,V),o0=s.get(x)||0;s.set(x,o0+1);const{score:f0}=Ge(n,a,A,y,s,x,r+1,l,-f,-i);A0(k,n),o0?s.set(x,o0):s.delete(x);const K=-f0;if(K>p&&(p=K,w=k),K>i&&(i=K),f<=i){if(k.captured===null){const T=He[r];(!T[0]||k.from!==T[0].from||k.to!==T[0].to)&&(T[1]=T[0],T[0]=k),Ve[k.from][k.to]+=2^l-r}break}}let O=P.EXACT;const M=p;return M<=u?O=P.UPPER_BOUND:M>=f&&(O=P.LOWER_BOUND),hn(d,{rootId:Y0,depth:l-r,value:M,flag:O,bestMove:w}),{score:p,move:w}};let Y0=0;function io(n,e,t,o,s,c,r=1/0){D0(),he();const l=performance.now();let i=null,f=null;const a=o?o%8:-1,m=L0(n,e,a,t);Y0=0;for(let d=1;d<=c;d++){const{score:u,move:E}=Ge(n,e,t,o,s,m,0,d,-1/0,1/0);if(E!==null&&(f=u,i=E),Math.abs(u)>c0-d&&E||performance.now()-l>r)break;Y0++}return{...i,bestEval:f}}const lo=(n,e,t,o,s=new Map,c=0,r=1/0)=>{const l=g0(n,e,t,o);return l[Math.floor(Math.random()*l.length)]},$e={[X.BMV1]:lo,[X.BMV2]:oo,[X.BMV3]:so,[X.BMV4]:ro,[X.BMV5]:io};self.onmessage=async n=>{const{engine1:e,eng1Depth:t,engine2:o,eng2Depth:s,games:c}=n.data;p0.setState({userSide:null});const{breakBattleLoop:r,resetGame:l}=p0.getState(),i=$e[e],f=$e[o];let a=0,m=0,d=0,u=1,E=i,g=f,B=t,v=s;for(;u<=c&&!r;){for(l({isEngineGame:!0}),await to();!p0.getState().isGameOver&&(Be(E,B,5e3),!p0.getState().isGameOver);)Be(g,v,5e3);const p=p0.getState().result,w=u%2===1?1:2,O=p.charAt(0);O===(w===1?"W":"B")?a++:O==="D"?m++:d++,[E,g]=[g,E],[B,v]=[v,B];const k=(a/u*100).toFixed(1);self.postMessage({type:"progress",gameNum:u,wins:a,draws:m,losses:d,winRate:k}),u++}const N=(a/c*100).toFixed(1);self.postMessage({type:"done",gameNum:u,wins:a,draws:m,losses:d,winRate:N})}})();
